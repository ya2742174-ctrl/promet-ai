<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Promet Ai",
  "alternateName": "â„™ğ•£ğ• ğ•ğ•–ğ•¥ ğ”¸ğ•š",
  "url": "https://ya2742174-ctrl.github.io/453532/"
}
</script>
  <meta name="description" content="Ù…ÙˆÙ‚Ø¹ Promet Ai Ù‡Ùˆ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø±Ø§Ø¦Ø¯Ø© Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª (Ø£ÙˆØ§Ù…Ø±) Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±ØŒ ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©. Ø§Ù†Ø¶Ù… Ù„Ù…Ø¬ØªÙ…Ø¹ â„™ğ•£ğ• ğ•ğ•–ğ•¥ ğ”¸ğ•š Ø§Ù„Ø¢Ù†.">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Promet Ai | â„™ğ•£ğ• ğ•ğ•–ğ•¥ ğ”¸ğ•š ğŸš€ - Ù…Ù†ØµØ© Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=Reem+Kufi:wght@700&display=swap" rel="stylesheet">
    
    <link id="prism-theme-link" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <style>
        :root {
            --accent: #3b82f6; --accent-glow: #60a5fa; --secondary: #8b5cf6;
            --danger: #ef4444; --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #f1f5f9; --text-muted: #94a3b8;
            --gold: #fbbf24; --success: #10b981;
            --level-color: #ec4899;
            --verified-blue: #1d9bf0;
            --winter-blue: #a5f3fc;
            --neon-pink: #ff00de;
            --neon-cyan: #00ffff;
            --neon-green: #0f0;
        }

        body.light-mode {
            --bg: #f8fafc; --card-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(0, 0, 0, 0.1);
            --text-main: #1e293b; --text-muted: #64748b;
        }

        * { box-sizing: border-box; font-family: 'IBM Plex Sans Arabic', sans-serif; -webkit-tap-highlight-color: transparent; }
        html, body { margin: 0; background-color: var(--bg); color: var(--text-main); transition: background-color 0.3s, color 0.3s; overflow-x: hidden; scroll-behavior: smooth; min-height: 100vh; }
        
        img { max-width: 100%; height: auto; }

        /* --- Site Themes (FIXED Z-INDEX) --- */
        #matrixCanvas { position: fixed; top:0; left:0; width:100%; height:100%; z-index: 0; display: none; pointer-events: none; opacity: 0.8; }
        #spaceBg { position: fixed; top:0; left:0; width:100%; height:100%; z-index: 0; display: none; background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%); overflow: hidden; pointer-events: none; }
        .space-star { position: absolute; background: white; border-radius: 50%; animation: twinkle infinite linear; }
        @keyframes twinkle { 0% { opacity: 0; transform: translateY(0); } 50% { opacity: 1; } 100% { opacity: 0; transform: translateY(-50px); } }

        /* Ensure content is above themes */
        header, main, .modal-overlay, .marquee-container { position: relative; z-index: 10; }

        /* --- Animations & Neon Effects --- */
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        @keyframes neonPulse { 0% { text-shadow: 0 0 5px #fff, 0 0 10px var(--neon-pink); } 100% { text-shadow: 0 0 2px #fff, 0 0 20px var(--neon-pink), 0 0 30px var(--neon-pink); } }
        @keyframes spinNeon { 0% { transform: rotate(0deg); filter: hue-rotate(0deg); } 100% { transform: rotate(360deg); filter: hue-rotate(360deg); } }
        @keyframes lightningFlash { 0%, 100% { opacity: 1; filter: drop-shadow(0 0 2px #fff); } 50% { opacity: 0.8; filter: drop-shadow(0 0 15px var(--accent)); } 10%, 90% { transform: translate(-1px, 1px); } }
        @keyframes buyPulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

        /* --- GLITCH EFFECT --- */
        @keyframes glitchText {
           0% { text-shadow: 2px 2px 0px #f00, -2px -2px 0px #00f; transform: translate(0); }
           20% { text-shadow: -2px -2px 0px #f00, 2px 2px 0px #00f; transform: translate(-1px, 1px); }
           40% { text-shadow: 2px -2px 0px #f00, -2px 2px 0px #00f; transform: translate(1px, -1px); }
           60% { text-shadow: -2px 2px 0px #f00, 2px -2px 0px #00f; transform: translate(-1px, -1px); }
           80% { text-shadow: 2px 2px 0px #f00, -2px -2px 0px #00f; transform: translate(1px, 1px); }
           100% { text-shadow: 2px 2px 0px #f00, -2px -2px 0px #00f; transform: translate(0); }
        }
        .name_glitch { color: #fff; font-weight: 800; text-transform: uppercase; animation: glitchText 0.3s infinite linear alternate-reverse; letter-spacing: 1px; font-family: monospace; }

        /* --- Global Shoutout Marquee --- */
        .marquee-container { background: linear-gradient(90deg, #111, #000, #111); border-bottom: 2px solid var(--neon-cyan); overflow: hidden; white-space: nowrap; height: 35px; display: flex; align-items: center; position: relative; z-index: 60; box-shadow: 0 0 10px var(--neon-cyan); }
        .marquee-text { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; color: #fff; text-shadow: 0 0 5px var(--neon-cyan); font-weight: bold; font-size: 14px; }

        /* --- Header --- */
        header { display: flex; align-items: center; justify-content: space-between; padding: 10px 5%; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; height: 60px; }
        main { padding: 15px 5%; max-width: 1300px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: 280px 1fr; gap: 20px; align-items: start; }
        @media (max-width: 900px) { header { padding: 10px 15px; } main { padding: 10px; } .grid { display: flex; flex-direction: column; } section { order: 1; width: 100%; } aside { order: 2; width: 100%; margin-top: 20px; } .header-title { display: none; } }

        /* --- Components --- */
        .card { background: var(--card-bg); backdrop-filter: blur(12px); border-radius: 16px; padding: 15px; border: 1px solid var(--glass-border); margin-bottom: 15px; transition: 0.3s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        button { background: linear-gradient(90deg, var(--accent), var(--secondary)); border: none; color: white; padding: 10px 15px; border-radius: 10px; cursor: pointer; transition: 0.3s; font-weight: 600; display: inline-flex; align-items: center; justify-content: center; gap: 5px; font-size: 13px; white-space: nowrap; }
        button:hover { transform: translateY(-2px); filter: brightness(1.1); }
        button:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .btn-xs { padding: 4px 8px !important; font-size: 10px !important; min-height: auto; height: auto; border-radius: 6px; }
        .btn-icon { background: rgba(255,255,255,0.05); color: var(--text-main); padding: 8px; border-radius: 8px; border: 1px solid var(--glass-border); min-width: 35px; }
        .btn-gold { background: linear-gradient(90deg, #d97706, #fbbf24); color: #000; }
        .btn-danger { background: linear-gradient(90deg, #991b1b, #ef4444); color: white; }
        .btn-success { background: linear-gradient(90deg, #059669, #10b981); color: white; }
        .btn-purple { background: linear-gradient(90deg, #7c3aed, #a78bfa); color: white; }
        .btn-blue { background: linear-gradient(90deg, #2563eb, #3b82f6); color: white; }
        .btn-winter { background: linear-gradient(90deg, #a5f3fc, #3b82f6); color: #000; }
        .btn-neon { background: transparent; border: 1px solid var(--neon-cyan); color: var(--neon-cyan); box-shadow: 0 0 5px var(--neon-cyan); }
        .btn-neon:hover { background: var(--neon-cyan); color: #000; box-shadow: 0 0 15px var(--neon-cyan); }
        .btn-buy-pulse { animation: buyPulse 2s infinite; }
        .btn-outline { background: transparent; border: 1px solid var(--glass-border); color: var(--text-muted); }
        .btn-owned { background: rgba(16, 185, 129, 0.15); border: 1px solid var(--success); color: var(--success); cursor: default; font-weight: bold; }
        .btn-mystery { background: linear-gradient(45deg, #ff00cc, #3333ff, #ff00cc); background-size: 200% 200%; animation: rainbow 3s ease infinite; color: white; }
        @keyframes rainbow { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        input, textarea, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--glass-border); background: rgba(0, 0, 0, 0.2); color: var(--text-main); margin-bottom: 10px; font-size: 14px; outline: none; }
        input:focus, textarea:focus { border-color: var(--accent); }

        /* --- Posts Styles --- */
        .post { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 15px; margin-bottom: 15px; position: relative; overflow: hidden; transition: 0.3s; }
        .postui-comment-section { background: rgba(0,0,0,0.2); padding: 10px; margin-top: 10px; border-radius: 8px; display: none; }
        .comment-item { font-size: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); padding: 5px 0; }
        .post-style-galaxy { background: linear-gradient(135deg, #0f172a 0%, #312e81 100%) !important; border: 1px solid #6366f1; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }
        .post-style-midnight { background-color: #000 !important; border: 1px solid #333; }
        .post-style-cyberpunk { background-color: #050a14 !important; background-image: linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 0, 255, 0.1) 1px, transparent 1px) !important; background-size: 30px 30px !important; border: 1px solid var(--neon-cyan) !important; box-shadow: 0 0 10px var(--neon-cyan) !important; }
        .post-style-matrix { background-color: #000 !important; border: 1px solid #0f0 !important; position: relative; }
        .post-style-matrix::before { content: "1001010101001"; position: absolute; top:0; left:0; width:100%; height:100%; opacity: 0.1; color: #0f0; word-break: break-all; pointer-events: none; font-family: monospace; }
        .post-style-tokyo { background: linear-gradient(to bottom, #2c003e, #000) !important; border-bottom: 3px solid var(--neon-pink) !important; }
        .post-style-crystal { background: rgba(255, 255, 255, 0.05) !important; backdrop-filter: blur(20px) !important; border: 1px solid rgba(255, 255, 255, 0.3) !important; box-shadow: 0 0 15px rgba(255, 255, 255, 0.2) inset !important; }
        .post.highlighted { border: 2px solid #fbbf24 !important; box-shadow: 0 0 15px rgba(251, 191, 36, 0.2) !important; background: linear-gradient(to bottom right, rgba(251, 191, 36, 0.05), var(--card-bg)); }
        .post.featured { border: 2px solid #3b82f6 !important; box-shadow: 0 0 20px rgba(59, 130, 246, 0.4) !important; background: linear-gradient(to bottom right, rgba(59, 130, 246, 0.1), var(--card-bg)); order: -1; }
        .pinned-badge { position: absolute; top: 0; left: 0; background: var(--gold); color: #000; padding: 4px 10px; border-radius: 0 0 10px 0; font-size: 11px; font-weight: bold; z-index: 10; }
        .featured-badge { position: absolute; top: 0; right: 0; background: var(--accent); color: white; padding: 4px 10px; border-radius: 0 0 0 10px; font-size: 11px; font-weight: bold; z-index: 10; }
        .post-img { width: 100%; border-radius: 10px; margin-top: 10px; max-height: 400px; object-fit: cover; border: 1px solid var(--glass-border); }

        /* --- Frames, Gradients & Pets --- */
        .frame_neon { border: 2px solid #fff !important; box-shadow: 0 0 5px #fff, 0 0 10px #0ff, 0 0 20px #0ff; }
        .frame_gold { border: 3px double #ffd700 !important; box-shadow: 0 0 10px #ffd700; }
        .frame_ice { border: 3px solid #a5f3fc !important; box-shadow: 0 0 10px #a5f3fc, inset 0 0 10px #a5f3fc; } 
        .frame_wormhole { border: 3px dashed var(--neon-cyan) !important; border-radius: 50%; animation: spinNeon 3s linear infinite; }
        .frame_laser { border: 2px solid #0f0 !important; box-shadow: 0 0 10px #0f0, 0 0 20px #0f0 inset !important; border-radius: 10px !important; }
        .frame_frozen_neon { border: 3px solid var(--neon-cyan) !important; box-shadow: 0 0 15px var(--accent) !important; position: relative; }
        .effect_lightning { animation: lightningFlash 2s infinite; }
        .grad_fire { background: linear-gradient(to right, #fca5a5, #ef4444, #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; font-weight: 800; }
        .grad_ice { background: linear-gradient(to right, #a5f3fc, #3b82f6, #6366f1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; font-weight: 800; }
        .grad_rainbow { background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; font-weight: 800; animation: hue 5s infinite linear; }
        .grad_blizzard { background: linear-gradient(to right, #ffffff, #a5f3fc, #3b82f6, #ffffff); background-size: 200% auto; animation: shine 3s linear infinite; -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        .name_glowing { color: #fff; text-shadow: 0 0 5px var(--neon-pink), 0 0 15px var(--neon-pink); animation: neonPulse 1.5s infinite alternate; }
        @keyframes shine { to { background-position: 200% center; } }
        @keyframes hue { from { filter: hue-rotate(0deg); } to { filter: hue-rotate(360deg); } }
        .verified-tick { color: var(--verified-blue); margin-right: 4px; display: inline-flex; align-items: center; vertical-align: middle; }
        .user-pet { font-size: 16px; margin-right: 5px; animation: bounce 2s infinite; display: inline-block; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }

        /* --- Text Styles --- */
        .style_hacker { font-family: monospace; color: #0f0; text-shadow: 0 0 5px #0f0; }
        .style_invisible { filter: blur(5px); transition: 0.3s; cursor: help; user-select: none; }
        .style_invisible:hover { filter: blur(0); }
        .style_wavy { display: inline-block; animation: wavy 1s ease-in-out infinite; }
        @keyframes wavy { 0%,100% { transform: skewX(0deg); } 50% { transform: skewX(-10deg); } }

        /* --- Shop --- */
        .shop-section-title { margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid var(--glass-border); padding-bottom: 5px; color: var(--gold); }
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .shop-item { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid var(--glass-border); text-align: center; display: flex; flex-direction: column; justify-content: space-between; height: 100%; position: relative;}
        .shop-item:hover { border-color: var(--accent); }
        .shop-badge-preview { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin: 10px 0; }
        .shop-banner-preview { height: 50px; border-radius: 8px; margin-bottom: 8px; background-size: cover; background-position: center; border: 1px solid #fff; }
        .edit-mode-active .shop-item { border-color: var(--danger); border-style: dashed; }

        /* --- Tabs & Utils --- */
        .nav-tabs { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .nav-tab { background: transparent; color: var(--text-muted); padding: 8px 14px; border-radius: 20px; border: 1px solid var(--glass-border); cursor: pointer; white-space: nowrap; font-size: 12px; flex-shrink: 0; }
        .nav-tab.active { background: var(--accent); color: white; border-color: var(--accent); }
        .level-badge { background: var(--level-color); color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-right: 5px; font-weight: bold; }
        .user-badge-display { display: inline-block; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-right: 5px; border: 1px solid rgba(255,255,255,0.2); }
        .xp-bar { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 5px; overflow: hidden; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, var(--level-color), var(--secondary)); width: 0%; transition: 1s; }
        
        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index:100; display:none; align-items:center; justify-content:center; padding: 10px; }
        .modal-content { background: var(--bg); padding: 0; border-radius: 15px; width: 100%; max-width: 450px; border: 1px solid var(--glass-border); position: relative; max-height: 85vh; overflow-y: auto; }
        .modal-body { padding: 20px; }
        .close-modal { position: absolute; top: 15px; left: 15px; cursor: pointer; background: rgba(0,0,0,0.5); border-radius: 50%; width: 30px; height: 30px; color: white; display:flex; align-items:center; justify-content:center; z-index: 10; }
        .profile-banner { height: 120px; background-size: cover; background-position: center; position: relative; background-color: #334155; }
        #notification { position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); padding: 10px 20px; border-radius: 30px; z-index: 9999; display: none; font-size: 13px; box-shadow: 0 0 15px var(--accent); border: 1px solid var(--accent); text-align: center; color: white; white-space: nowrap; background: rgba(0,0,0,0.9); }
        
        /* Chat & Admin */
        .chat-container { display: flex; height: 550px; border: 1px solid var(--glass-border); border-radius: 12px; overflow: hidden; background: var(--card-bg); position: relative; }
        .chat-sidebar { width: 35%; border-left: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); overflow-y: auto; display: none; flex-direction: column; }
        .admin-mode .chat-sidebar { display: flex; }
        .chat-main { width: 100%; display: flex; flex-direction: column; background: rgba(0,0,0,0.05); }
        .admin-mode .chat-main { width: 65%; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { max-width: 85%; padding: 10px 15px; border-radius: 12px; font-size: 13px; word-wrap: break-word; }
        .msg-me { align-self: flex-end; background: var(--accent); color: white; border-bottom-left-radius: 0; }
        .msg-other { align-self: flex-start; background: rgba(255,255,255,0.1); border-bottom-right-radius: 0; }
        .user-list-item { padding: 10px; border-bottom: 1px solid var(--glass-border); cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
        .user-list-item:hover, .user-list-item.active { background: rgba(255,255,255,0.05); }
        @media(max-width: 768px) { .chat-container { flex-direction: column; height: 75vh; } .admin-mode .chat-sidebar { width: 100%; height: 35%; border-left: none; border-bottom: 1px solid var(--glass-border); } .admin-mode .chat-main { width: 100%; height: 65%; } }

        .upload-box { position: relative; overflow: hidden; display: inline-block; }
        .upload-box input[type=file] { position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; height: 100%; width: 100%; }
        .file-preview { margin-top: 10px; max-height: 150px; border-radius: 8px; display: none; border: 1px solid var(--glass-border); max-width: 100%; }
        .loader { width: 20px; height: 20px; border: 2px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Leaderboard & Slots & Toggle */
        .leaderboard-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--glass-border); }
        .leaderboard-rank { font-weight: bold; width: 25px; text-align: center; }
        .rank-1 { color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); font-size: 1.2em; }
        .rank-2 { color: #c0c0c0; font-size: 1.1em; }
        .rank-3 { color: #cd7f32; font-size: 1.1em; }
        .slot-machine { display: flex; gap: 5px; justify-content: center; margin: 10px 0; font-size: 24px; background: #000; padding: 10px; border-radius: 8px; border: 2px solid var(--gold); }
        .slot-reel { width: 40px; height: 50px; background: #222; display: flex; align-items: center; justify-content: center; border-radius: 4px; overflow: hidden; }
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* --- Snow & Visual Effects --- */
        .snowflake { position: fixed; top: -10px; color: #fff; font-size: 1em; font-family: Arial, sans-serif; text-shadow: 0 0 5px #000; z-index: 9999; pointer-events: none; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(105vh); } }
        .neon-particle { position: fixed; width: 8px; height: 8px; background: var(--neon-cyan); border-radius: 50%; pointer-events: none; z-index: 99999; box-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-pink); opacity: 0.8; animation: fadeOut 1s forwards; }
        @keyframes fadeOut { to { opacity: 0; transform: scale(0); } }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-online { background-color: #10b981; box-shadow: 0 0 5px #10b981; }
        .status-offline { background-color: #64748b; }

        /* --- SUPER REACTIONS --- */
        .money-rain-bill { position: fixed; top: -50px; font-size: 24px; z-index: 10000; animation: moneyFall 3s linear forwards; pointer-events: none; }
        @keyframes moneyFall { to { transform: translateY(110vh) rotate(360deg); } }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
        .nuke-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; position: relative; }
        .nuke-shake::after { content:""; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,0,0,0.2); pointer-events:none; z-index:9999; animation: flashRed 0.5s; }
        @keyframes flashRed { 0%{opacity:1} 100%{opacity:0} }

    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>
    <div id="spaceBg"></div>
    <div id="snowContainer"></div>
    <div id="notification"></div>
    
    <div class="marquee-container" id="globalShoutoutContainer" style="display:none;">
        <div class="marquee-text" id="shoutoutText">ğŸ“¢ Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙŠ Promet Ai!</div>
    </div>

    <header>
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="font-size:24px;">ğŸš€</div>
            <div><h1 class="header-title" style="font-size:18px; margin:0; font-weight:700;">â„™ğ•£ğ• ğ•ğ•–ğ•¥ ğ”¸ğ•š</h1></div>
        </div>
        
        <div class="header-controls" style="display:flex; align-items:center; gap:8px;">
            <button id="adminBtn" onclick="openAdminPanel()" class="btn-danger" style="display:none; padding:5px 10px; font-size:12px;">ğŸ›¡ï¸</button>
            <button id="dailyBonusBtn" onclick="claimDailyBonus()" style="display:none; background:var(--gold); color:black; padding:5px 10px; font-size:11px; border-radius:10px;">ğŸ</button>
            <button onclick="toggleTheme()" class="btn-icon">ğŸŒ—</button>
            
            <div id="userDisplay" onclick="openProfileModal()" class="user-pill" style="cursor:pointer; display:flex; align-items:center; gap:8px; background: rgba(255,255,255,0.05); padding: 4px 10px; border-radius: 20px; border: 1px solid var(--glass-border);">
                <span id="uLevelBadge" class="level-badge">L1</span>
                <span id="pts" style="color:var(--gold); font-weight:bold; font-size:13px;">0ğŸ’°</span>
                <img id="uAvatar" src="" style="width:28px; height:28px; border-radius:50%; background:#334155; object-fit: cover;">
            </div>
        </div>
    </header>

    <main>
        <div class="grid">
            <aside>
                <div class="card">
                    <h3>ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</h3>
                    <div id="leaderboard"><div class="loader"></div></div>
                </div>
            </aside>

            <section>
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="switchTab('feed')">ğŸ  Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</button>
                    <button class="nav-tab" onclick="switchTab('shop')">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</button>
                    <button class="nav-tab" onclick="switchTab('generator')">ğŸ¨ Ø§Ù„Ø±Ø³Ù… (AI)</button>
                    <button class="nav-tab" onclick="switchTab('chat')">ğŸ¤– Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯</button>
                    <button class="nav-tab" onclick="switchTab('tools')">ğŸ› ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Øª</button>
                    <button class="nav-tab" onclick="switchTab('messages')">ğŸ’¬ Ø§Ù„Ø¯Ø¹Ù…</button>
                    <button class="nav-tab" onclick="switchTab('contests')">ğŸ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</button>
                </div>

                <div id="tab-feed">
                    <div class="card">
                        <h3>âœ¨ Ø§Ù†Ø´Ø± Ø¨Ø±ÙˆÙ…Ø¨Øª Ø¬Ø¯ÙŠØ¯</h3>
                        <input id="pTitle" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†...">
                        <textarea id="pContent" style="min-height: 100px;" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù„ÙˆØµÙ..."></textarea>
                        
                        <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px; flex-wrap: wrap;">
                             <div class="upload-box">
                                <button class="btn-icon">ğŸ“· Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
                                <input type="file" id="pImgFile" accept="image/*" onchange="previewFile()">
                            </div>
                            <select id="pType" style="margin:0; flex: 1; min-width: 120px;" onchange="togglePriceInput()">
                                <option value="free">Ù…Ø¬Ø§Ù†ÙŠ (5ğŸ’°)</option>
                                <option value="paid">Ù…Ø¯ÙÙˆØ¹ (Ø¨ÙŠØ¹)</option>
                            </select>
                            <input id="pPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" style="margin:0; flex: 1; display: none;">
                        </div>

                        <div style="display:flex; align-items:center; justify-content: space-between; gap:5px; margin-bottom:10px; font-size:13px;">
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="checkbox" id="pHighlight" style="width:auto; margin:0;">
                                <label for="pHighlight" style="cursor:pointer; color:var(--gold);">ğŸŒŸ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ù†Ø´ÙˆØ± (50ğŸ’°)</label>
                            </div>
                            <button onclick="spinForHighlight()" class="btn-purple btn-xs" style="font-size:11px !important;">ğŸ° ÙŠØ§Ù†ØµÙŠØ¨ Ø§Ù„ØªÙ…ÙŠÙŠØ² (10ğŸ’°)</button>
                        </div>
                        <div id="slotDisplay" class="slot-machine" style="display:none; border-color: var(--neon-cyan); box-shadow: 0 0 10px var(--neon-cyan);">
                            <div class="slot-reel" id="reel1">ğŸ’</div>
                            <div class="slot-reel" id="reel2">ğŸ’</div>
                            <div class="slot-reel" id="reel3">ğŸ’</div>
                        </div>

                        <img id="previewImg" class="file-preview">
                        <button id="publishBtn" onclick="publish()" style="width:100%">Ù†Ø´Ø± (+10 XP) ğŸš€</button>
                    </div>

                    <div style="display:flex; gap:10px; margin-bottom:15px; overflow-x: auto;">
                        <button id="filter-all" class="btn-outline active" style="font-size:12px; padding:5px 15px;" onclick="setFeedFilter('all')">Ø§Ù„ÙƒÙ„ ğŸŒ</button>
                        <button id="filter-following" class="btn-outline" style="font-size:12px; padding:5px 15px;" onclick="setFeedFilter('following')">Ø£ØªØ§Ø¨Ø¹Ù‡Ù… ğŸ‘¥</button>
                    </div>

                    <div id="feed"></div>
                </div>

                <div id="tab-shop" style="display:none;">
                    <div class="card">
                        <div id="shopHeader" style="display:none; text-align:center; padding:10px; background:rgba(239,68,68,0.2); border:1px solid var(--danger); border-radius:10px; margin-bottom:15px;">
                            <b style="color:var(--danger)">âš ï¸ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…ÙØ¹Ù„</b><br>
                            <span style="font-size:12px;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ù†ØµØ± Ù„ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø±Ù‡ ÙˆØ§Ø³Ù…Ù‡.</span>
                        </div>
                        
                        <div style="background: linear-gradient(to bottom right, rgba(251, 191, 36, 0.1), rgba(0,0,0,0.3)); border: 1px solid var(--gold); border-radius: 12px; padding: 15px; margin-bottom: 25px;">
                            <h3 style="color:var(--gold); text-align:center; margin-top:0;">ğŸ’³ Ø´Ø±Ø§Ø¡ Ø¹Ù…Ù„Ø§Øª (Points)</h3>
                            <div class="shop-grid">
                                <div class="shop-item" style="border-color:var(--gold);">
                                    <div style="font-size:24px;">ğŸ’°</div>
                                    <h4 style="margin:5px 0;">1,000 Ù†Ù‚Ø·Ø©</h4>
                                    <button onclick="requestPoints(1000)" class="btn-gold">Ø´Ø±Ø§Ø¡ (ØªÙˆØ§ØµÙ„)</button>
                                </div>
                                <div class="shop-item" style="border-color:var(--gold);">
                                    <div style="font-size:24px;">ğŸ’°ğŸ’°</div>
                                    <h4 style="margin:5px 0;">5,000 Ù†Ù‚Ø·Ø©</h4>
                                    <button onclick="requestPoints(5000)" class="btn-gold">Ø´Ø±Ø§Ø¡ (ØªÙˆØ§ØµÙ„)</button>
                                </div>
                                <div class="shop-item" style="border-color:var(--gold);">
                                    <div style="font-size:24px;">ğŸ’</div>
                                    <h4 style="margin:5px 0;">15,000 Ù†Ù‚Ø·Ø©</h4>
                                    <button onclick="requestPoints(15000)" class="btn-gold">Ø´Ø±Ø§Ø¡ (ØªÙˆØ§ØµÙ„)</button>
                                </div>
                                <div class="shop-item" style="border-color:var(--gold);">
                                    <div style="font-size:24px;">ğŸ‘‘</div>
                                    <h4 style="margin:5px 0;">50,000 Ù†Ù‚Ø·Ø©</h4>
                                    <button onclick="requestPoints(50000)" class="btn-gold">Ø´Ø±Ø§Ø¡ (ØªÙˆØ§ØµÙ„)</button>
                                </div>
                            </div>
                            <div style="display:flex; gap:10px; align-items:center; margin-top:10px;">
                                <input id="redeemCodeInput" placeholder="Ù„Ø¯ÙŠÙƒ ÙƒÙˆØ¯ Ù‡Ø¯ÙŠØ©ØŸ Ø§Ø¯Ø®Ù„Ù‡ Ù‡Ù†Ø§..." style="margin:0;">
                                <button onclick="redeemCode()" class="btn-purple" style="width:120px;">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¯</button>
                            </div>
                        </div>

                        <div id="dynamicShopContainer">
                            <div class="loader" style="margin: 20px auto; display:block;"></div>
                        </div>

                    </div>
                </div>

                <div id="tab-generator" style="display:none;">
                    <div class="card">
                        <h3>ğŸ¨ ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                        <textarea id="genPrompt" placeholder="ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©..."></textarea>
                        <button id="generateBtn" onclick="generateImage()" style="width:100%">ØªÙˆÙ„ÙŠØ¯ (5ğŸ’°)</button>
                        <div id="imgBox" style="margin-top:20px; text-align:center;">
                            <img id="resultImage" style="max-width:100%; display:none; border-radius:12px;" />
                            <div id="genLoader" class="loader" style="display:none;"></div>
                        </div>
                    </div>
                </div>

                <div id="tab-chat" style="display:none;">
                    <div class="card">
                        <h3>ğŸ¤– Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</h3>
                        <div id="botHistory" style="height:300px; overflow-y:auto; background:rgba(0,0,0,0.2); padding:10px; border-radius:10px; margin-bottom:10px;"></div>
                        <div style="display:flex; gap:5px;"><input id="botInput" placeholder="Ø§Ø³Ø£Ù„Ù†ÙŠ..." style="margin:0;"><button id="btnSendBot" onclick="askBot()" style="width:80px;">Ø¥Ø±Ø³Ø§Ù„</button></div>
                    </div>
                </div>
                
                <div id="tab-tools" style="display:none;">
                     <div class="card">
                        <h3>ğŸ› ï¸ Ù…ØªØ±Ø¬Ù… Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª (Real API)</h3>
                        <textarea id="transInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ..."></textarea>
                        <button id="btnTrans" onclick="translatePrompt()" style="width:100%">ØªØ±Ø¬Ù…Ø© ğŸ‡¬ğŸ‡§</button>
                        <textarea id="transOutput" placeholder="Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§..." style="margin-top:10px;" readonly></textarea>
                    </div>
                </div>

                <div id="tab-messages" style="display:none;">
                     <div class="card" style="padding:0; overflow:hidden;">
                        <div class="chat-container" id="supportChatContainer">
                            <div class="chat-sidebar" id="conversationsList">
                                <div style="padding:15px; border-bottom:1px solid var(--glass-border); font-weight:bold;">ğŸ’¬ ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…ÙØªÙˆØ­Ø©</div>
                                <div id="adminUserList" style="flex:1;">
                                    <div class="loader" style="margin:10px auto; display:block;"></div>
                                </div>
                            </div>
                            
                            <div class="chat-main">
                                <div id="activeChatHeader" style="padding:10px; background:rgba(0,0,0,0.1); border-bottom:1px solid var(--glass-border);">
                                    <span id="chatTitle">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</span>
                                </div>
                                <div id="dmMessages" class="chat-messages">
                                    <div style="text-align:center; margin-top:20px; opacity:0.7;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                                </div>
                                <div style="padding:10px; display:flex; gap:10px; border-top:1px solid var(--glass-border);">
                                    <input id="dmInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." style="margin:0;">
                                    <button onclick="sendDM()" class="btn-icon">â¤</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-contests" style="display:none;">
                    <div class="card" style="border: 2px solid var(--gold);">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3>ğŸ† Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
                            <div id="adminContestControls" style="display:none;"><button onclick="endContest()" class="btn-danger" style="font-size:11px;">â›” Ø¥Ù†Ù‡Ø§Ø¡</button></div>
                        </div>
                        <p>Ø±Ø´Ø­ Ø£ÙØ¶Ù„ Ù…Ù†Ø´ÙˆØ±Ø§ØªÙƒ Ù„Ù„Ù…Ù†Ø§ÙØ³Ø©! Ø±Ø³Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: 50ğŸ’°.</p>
                    </div>
                    <div id="contestEntries"><div class="loader"></div></div>
                </div>
            </section>
        </div>
    </main>

    <div id="authModal" class="modal-overlay">
        <div class="card" style="width:100%; max-width:350px;">
            <h3 style="text-align: center;">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
            <input id="uName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input id="uPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button onclick="auth()" style="width:100%">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
        </div>
    </div>

    <div id="adminPanel" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <button onclick="document.getElementById('adminPanel').style.display='none'" class="close-modal">âœ•</button>
            <div class="modal-body">
                <h3>ğŸ›¡ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</h3>
                
                <button id="superAdminEditBtn" onclick="toggleEditMode()" style="display:none; width:100%; margin-bottom:15px;" class="btn-danger">ğŸ› ï¸ ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø± (Ø¥ÙŠÙ‚Ø§Ù/ØªØ´ØºÙŠÙ„)</button>

                <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 10px; border: 1px solid var(--success); margin-bottom: 20px;">
                    <h4 style="margin-top: 0; color: var(--success); font-size: 14px;">ğŸ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ù‡Ø¯ÙŠØ©</h4>
                    <div style="display: flex; gap: 10px;">
                        <input id="adminCodeStr" placeholder="Ø§Ù„ÙƒÙˆØ¯ (Ù…Ø«Ù„Ø§ BONUS500)" style="margin:0; flex: 2;">
                        <input id="adminCodeVal" type="number" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" style="width: 80px; margin:0; flex: 1;">
                    </div>
                    <button onclick="createGiftCode()" class="btn-success" style="width: 100%; margin-top: 10px;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯</button>
                </div>
                <div style="background: rgba(251, 191, 36, 0.1); padding: 15px; border-radius: 10px; border: 1px solid var(--gold); margin-bottom: 20px;">
                    <h4 style="margin-top: 0; color: var(--gold); font-size: 14px;">ğŸ’° Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· (ÙŠØ¯ÙˆÙŠ)</h4>
                    <div style="display: flex; gap: 10px;"><input id="adminTargetUser" placeholder="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…..." style="margin:0; flex: 2;"><input id="adminPointsAmount" type="number" placeholder="Ø§Ù„Ø¹Ø¯Ø¯" style="width: 80px; margin:0; flex: 1;"></div>
                    <button onclick="addPointsByAdmin()" class="btn-gold" style="width: 100%; margin-top: 10px;">Ø¥Ø±Ø³Ø§Ù„</button>
                </div>
            </div>
        </div>
    </div>

    <div id="profileModal" class="modal-overlay">
        <div class="modal-content">
            <button onclick="closeProfileModal()" class="close-modal">âœ•</button>
            <div id="pModalBanner" class="profile-banner"></div>
            
            <div class="modal-body" style="margin-top: -50px; position: relative;">
                <div style="text-align: center;">
                    <img id="pModalImg" src="" style="width: 90px; height: 90px; border-radius: 50%; border: 4px solid var(--card-bg); background: var(--bg); object-fit: cover;">
                    <h3 style="margin:10px 0; display:flex; align-items:center; justify-content:center; gap:5px;">
                        <span id="pModalStatus" class="status-dot status-offline"></span>
                        <span id="pModalName">User</span>
                        <span id="pModalVerified" class="verified-tick" style="display:none;">â˜‘ï¸</span>
                    </h3>
                    <div id="pModalBadge" style="margin-bottom:5px;"></div>
                    <div class="level-badge" id="pModalLvl" style="display:inline-block; font-size:12px;">Lvl 1</div>
                    <audio id="profileAudio" style="display:none;"></audio>
                    </div>

                <div style="display:flex; justify-content:center; gap:20px; margin:15px 0; font-size:13px; color:var(--text-muted);">
                    <div style="text-align:center;"><b id="pModalFollowers" style="color:var(--text-main); font-size:16px;">0</b><br>Ù…ØªØ§Ø¨ÙØ¹</div>
                    <div style="text-align:center;"><b id="pModalFollowing" style="color:var(--text-main); font-size:16px;">0</b><br>ÙŠØªØ§Ø¨ÙØ¹</div>
                </div>

                <div style="margin: 20px 0;">
                    <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;"><span>XP</span><span id="xpText">0</span></div>
                    <div class="xp-bar"><div id="xpFill" class="xp-fill"></div></div>
                </div>

                <div id="profileMyControls" style="display:none;">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <button onclick="toggleTransferMode()" class="btn-success">ğŸ’¸ ØªØ­ÙˆÙŠÙ„</button>
                        <button onclick="toggleHistoryMode()" class="btn-icon" style="width:100%">ğŸ“œ Ø§Ù„Ø³Ø¬Ù„</button>
                    </div>

                    <div id="transferSection" style="display:none; margin-top:15px; padding:10px; background:rgba(0,0,0,0.1); border-radius:10px;">
                        <input id="transReceiver" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…"><input id="transAmount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                        <button onclick="transferPoints()" style="width:100%">Ø¥Ø±Ø³Ø§Ù„</button>
                    </div>
                    <div id="historySection" style="display:none; margin-top:15px; max-height:200px; overflow-y:auto;">
                        <div id="historyList" style="font-size:12px;"></div>
                    </div>

                    <hr style="border-color:var(--glass-border); margin:20px 0;">
                    
                    <div id="editProfileSection">
                        <h4>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</h4>
                        <div id="ghostModeControl" style="display:none; margin-bottom:10px; align-items:center; gap:10px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="ghostSwitch" onchange="toggleGhostMode()">
                                <span class="slider"></span>
                            </label>
                            <span style="font-size:12px;">ğŸ‘» ÙˆØ¶Ø¹ Ø§Ù„ØªØ®ÙÙŠ (Ù†Ø´Ø·)</span>
                        </div>
                        <button id="btnUseRename" onclick="useRenameCard()" style="display:none; width:100%; margin-bottom:10px;" class="btn-purple">ğŸ·ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø·Ø§Ù‚Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…</button>
                        <div id="anthemControl" style="display:none; margin-bottom:10px;">
                            <input id="anthemUrl" placeholder="Ø±Ø§Ø¨Ø· MP3 Ù„Ù„Ù†ØºÙ…Ø© (Ù…Ø¨Ø§Ø´Ø±)..." style="font-size:12px;">
                        </div>
                        <input id="editPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
                        <input type="file" id="avatarUpload" accept="image/*" style="font-size:12px;">
                        <div style="font-size:10px; color:var(--text-muted); margin-bottom:10px;">âš ï¸ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø©: 1 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</div>
                        <button onclick="saveProfile()" style="width:100%">ğŸ’¾ Ø­ÙØ¸</button>
                    </div>
                    <button onclick="logout()" class="btn-danger" style="width:100%; margin-top:15px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyP016himjW1TiccHc0SiByPjOW0Vzv_Vs",
            authDomain: "yousefprompts-public-58082.firebaseapp.com",
            projectId: "yousefprompts-public-58082",
            storageBucket: "yousefprompts-public-58082.appspot.com",
            messagingSenderId: "1029355842188",
            appId: "1:1029355842188:web:b72df7144a0027c2e6da39"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const ADMINS = ["Youssef", "MakariOs"];
        const SUPER_ADMIN = "Youssef"; // Only this user can edit the site
        let user = localStorage.getItem('uName');
        let userData = {};
        let feedFilter = 'all';
        let chatListener = null;
        let currentChatUser = null; 
        let matrixInterval = null; 
        let isEditMode = false; // Admin Edit Mode State
        let shopItemsList = []; // Will be populated from DB

        // --- Data Structure for Initial Seeding (If DB is empty) ---
        const initialShopItems = [
            // Themes
            {id: 'theme_matrix', type: 'site_theme', price: 5000, name: 'Ø§Ù„Ù…ØµÙÙˆÙØ© (Matrix)', icon: '010101', iconStyle: 'color:#0f0; font-family:monospace; font-size:20px;', category: 'themes', btnClass: 'btn-neon'},
            {id: 'theme_space', type: 'site_theme', price: 5000, name: 'Ø§Ù„ÙØ¶Ø§Ø¡ (Space)', icon: 'âœ¨ğŸŒ‘', category: 'themes', btnClass: 'btn-outline'},
            
            // Fonts / Styles
            {id: 'style_hacker', type: 'text_style', price: 5000, name: 'Ø®Ø· Ø§Ù„Ù‡Ø§ÙƒØ±', className: 'style_hacker', category: 'styles', btnClass: 'btn-neon'},
            {id: 'style_invisible', type: 'text_style', price: 6000, name: 'Ø­Ø¨Ø± Ø³Ø±ÙŠ', className: 'style_invisible', category: 'styles', btnClass: 'btn-outline'},
            {id: 'style_wavy', type: 'text_style', price: 4000, name: 'Ù†Øµ Ù…ØªÙ…ÙˆØ¬', className: 'style_wavy', category: 'styles', btnClass: 'btn-outline'},
            
            // Pets
            {id: 'pet_bot', type: 'pet', price: 8000, name: 'Mini Bot', icon: 'ğŸ¤–', category: 'pets', btnClass: 'btn-outline'},
            {id: 'pet_cat', type: 'pet', price: 10000, name: 'Neon Cat', icon: 'ğŸ±', category: 'pets', btnClass: 'btn-neon'},
            {id: 'pet_ghost', type: 'pet', price: 12000, name: 'Ghost Pet', icon: 'ğŸ‘»', category: 'pets', btnClass: 'btn-outline'},

            // Consumables
            {id: 'ticket_shoutout', type: 'action', action: 'buyShoutout', price: 5000, name: 'Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± (Ø³Ø§Ø¹Ø©)', icon: 'ğŸ“¢', category: 'consumables', btnClass: 'btn-neon'},
            {id: 'ticket_featured', type: 'consumable', price: 5000, name: 'ØªØ°ÙƒØ±Ø© Ø§Ù„ØªÙˆØ¨ (Featured)', icon: 'ğŸš€', category: 'consumables', btnClass: 'btn-outline'},
            {id: 'booster_xp', type: 'consumable', price: 5000, name: 'XP Booster (x2)', icon: 'ğŸ§ª', category: 'consumables', btnClass: 'btn-outline'},
            {id: 'item_rename_card', type: 'consumable', price: 10000, name: 'Ø¨Ø·Ø§Ù‚Ø© ØªØºÙŠÙŠØ± Ø§Ø³Ù…', icon: 'ğŸ·ï¸', sub: 'Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©', category: 'consumables', btnClass: 'btn-outline'},

            // Reactions / Audio
            {id: 'pack_reactions', type: 'permanent', price: 8000, name: 'Ø­Ø²Ù…Ø© Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª', icon: 'ğŸ”¥ğŸ’©ğŸš€', category: 'reactions', btnClass: 'btn-outline'},
            {id: 'unlock_anthem', type: 'permanent', price: 15000, name: 'Ù†ØºÙ…Ø© Ø´Ø®ØµÙŠØ©', icon: 'ğŸµ', category: 'reactions', btnClass: 'btn-outline'},

            // Winter
            {id: 'badge_snowman', type: 'badge', price: 2025, name: 'Ø±Ø¬Ù„ Ø§Ù„Ø«Ù„Ø¬', icon: 'â˜ƒï¸', sub: 'Ù„Ù‚Ø¨ Ù…Ù…ÙŠØ²', category: 'winter', btnClass: 'btn-winter', border: 'var(--winter-blue)'},
            {id: 'frame_ice', type: 'frame', price: 6000, name: 'Ø¥Ø·Ø§Ø± Ø¬Ù„ÙŠØ¯ÙŠ', cssPreview: 'width:30px; height:30px; border-radius:50%; border: 3px solid #a5f3fc; box-shadow: 0 0 10px #a5f3fc;', category: 'winter', btnClass: 'btn-winter', border: 'var(--winter-blue)'},
            {id: 'grad_blizzard', type: 'gradient', price: 12000, name: 'Ø¹Ø§ØµÙØ©', className: 'grad_blizzard', category: 'winter', btnClass: 'btn-winter', border: 'var(--winter-blue)'},
            {id: 'banner_winter', type: 'banner', price: 5000, name: 'Ø¨Ù†Ø± Ø´ØªÙˆÙŠ', bgImage: 'https://media.giphy.com/media/Xi2Xu0MejhsUo/giphy.gif', category: 'winter', btnClass: 'btn-winter', border: 'var(--winter-blue)'},

            // Banners
            {id: 'banner_vaporwave', type: 'banner', price: 7000, name: 'Vaporwave', bgImage: 'https://media.giphy.com/media/3o7aD2saalBwwftBIY/giphy.gif', category: 'banners', btnClass: 'btn-purple'},
            {id: 'banner_space', type: 'banner', price: 6000, name: 'Deep Space', bgImage: 'https://media.giphy.com/media/U3qYN8S0j3bpK/giphy.gif', category: 'banners', btnClass: 'btn-outline'},
            {id: 'banner_anime', type: 'banner', price: 5000, name: 'Anime Rain', bgImage: 'https://media.giphy.com/media/13CoXDiaCcCoyk/giphy.gif', category: 'banners', btnClass: 'btn-outline'},
            {id: 'banner_glitch', type: 'banner', price: 6000, name: 'Glitch Art', bgImage: 'https://media.giphy.com/media/l41YkxvU8c7J7Bba0/giphy.gif', category: 'banners', btnClass: 'btn-outline'},

            // Special / Mystery
            {id: 'sub_verified', type: 'subscription', price: 25000, name: 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø³Ø§Ø¨', icon: 'â˜‘ï¸', category: 'special', btnClass: 'btn-blue'},
            {id: 'license_ghost', type: 'permanent', price: 30000, name: 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ®ÙÙŠ', icon: 'ğŸ‘»', category: 'special', btnClass: 'btn-outline'},
            {id: 'box_mystery', type: 'box', price: 2000, name: 'ØµÙ†Ø¯ÙˆÙ‚ Ø¹Ø´ÙˆØ§Ø¦ÙŠ', icon: 'â“', sub: 'Ø­Ø¸Ùƒ ÙˆÙ†ØµÙŠØ¨Ùƒ', category: 'boxes', btnClass: 'btn-mystery', boxType: 'mystery'},
            {id: 'box_avatar', type: 'box', price: 5000, name: 'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£ÙØ§ØªØ§Ø±', icon: 'ğŸ‘¾', sub: 'Ø£ÙØ§ØªØ§Ø± Ù†Ø§Ø¯Ø±', category: 'boxes', btnClass: 'btn-mystery', boxType: 'avatar'},

            // Neon World
            {id: 'name_glitch', type: 'gradient', price: 30000, name: 'GLITCH Name', sub: 'ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‡Ø§ÙƒØ±', className: 'name_glitch', category: 'neon', btnClass: 'btn-danger', border: '#f00'},
            {id: 'effect_lightning', type: 'badge', price: 15000, name: 'Ø­Ø²Ù…Ø© Ø§Ù„Ø¨Ø±Ù‚', sub: 'ÙˆÙ…ÙŠØ¶ Ø­ÙˆÙ„ Ø§Ù„Ø£ÙØ§ØªØ§Ø±', icon: 'âš¡', category: 'neon', btnClass: 'btn-neon btn-buy-pulse', border: 'var(--accent)'},
            {id: 'name_glowing', type: 'gradient', price: 25000, name: 'Ø§Ø³Ù… Ù…Ø´Ø¹', sub: 'Ù†Ø¨Ø¶ Ù„ÙˆÙ†ÙŠ', className: 'name_glowing', category: 'neon', btnClass: 'btn-neon btn-buy-pulse', border: 'var(--neon-pink)'},
            {id: 'effect_trail', type: 'permanent', price: 20000, name: 'Ø¨ØµÙ…Ø© Ø§Ù„Ù†ÙŠÙˆÙ†', sub: 'ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø§ÙˆØ³', icon: 'ğŸ–±ï¸', category: 'neon', btnClass: 'btn-neon', border: 'var(--neon-cyan)'},
            {id: 'frame_wormhole', type: 'frame', price: 12000, name: 'Ø§Ù„Ø«Ù‚Ø¨ Ø§Ù„Ø¯ÙˆØ¯ÙŠ', cssPreview: 'width:40px; height:40px; border-radius:50%; border: 3px dashed var(--neon-cyan); animation: spinNeon 3s linear infinite;', category: 'neon_frames', btnClass: 'btn-neon'},
            {id: 'frame_laser', type: 'frame', price: 9000, name: 'Ø¯Ø±Ø¹ Ø§Ù„Ù„ÙŠØ²Ø±', cssPreview: 'width:40px; height:40px; border-radius:10px; border: 2px solid #0f0; box-shadow: 0 0 10px #0f0 inset;', category: 'neon_frames', btnClass: 'btn-neon'},
            {id: 'frame_frozen_neon', type: 'frame', price: 10000, name: 'Ù†ÙŠÙˆÙ† Ù…ØªØ¬Ù…Ø¯', cssPreview: 'width:40px; height:40px; border-radius:50%; border: 3px solid var(--neon-cyan); box-shadow: 0 0 15px var(--accent);', category: 'neon_frames', btnClass: 'btn-winter'},

            // Classic
            {id: 'badge_fire', type: 'badge', price: 2000, name: 'ğŸ”¥ Ø§Ù„Ù…ØªÙØ§Ø¹Ù„', previewBadge: 'ğŸ”¥ Ø§Ù„Ù…ØªÙØ§Ø¹Ù„', previewBg: '#333', previewColor: 'var(--gold)', category: 'classic', btnClass: 'btn-outline'},
            {id: 'badge_pro', type: 'badge', price: 3000, name: 'ğŸ›¡ï¸ Ø§Ù„Ù…Ø­ØªØ±Ù', previewBadge: 'ğŸ›¡ï¸ Ø§Ù„Ù…Ø­ØªØ±Ù', previewBg: '#333', previewColor: 'var(--accent)', category: 'classic', btnClass: 'btn-outline'},
            {id: 'badge_legend', type: 'badge', price: 100000, name: 'ğŸ’ Ø§Ù„Ù…Ù„Ùƒ', previewBadge: 'ğŸ’ Ø§Ù„Ù…Ù„Ùƒ', previewBg: '#333', previewColor: 'white', category: 'classic', btnClass: 'btn-purple'},
            {id: 'frame_neon', type: 'frame', price: 5000, name: 'Ø¥Ø·Ø§Ø± Ù†ÙŠÙˆÙ† (Ù‚Ø¯ÙŠÙ…)', cssPreview: 'width:30px; height:30px; border-radius:50%; box-shadow:0 0 0 2px #fff, 0 0 10px #0ff;', category: 'classic', btnClass: 'btn-outline'},
            {id: 'frame_gold', type: 'frame', price: 8000, name: 'Ø¥Ø·Ø§Ø± Ø°Ù‡Ø¨ÙŠ', cssPreview: 'width:30px; height:30px; border-radius:50%; box-shadow:0 0 0 3px #ffd700, 0 0 10px #ffd700;', category: 'classic', btnClass: 'btn-gold'},

            // Super Reactions
            {id: 'reaction_money', type: 'reaction_buy', action: 'buySuperReaction', price: 100, name: 'Ù…Ø·Ø± Ø§Ù„Ø£Ù…ÙˆØ§Ù„', icon: 'ğŸ’¸', sub: 'ØªØ±Ø³Ù„ 50ğŸ’° Ù„Ù„ÙƒØ§ØªØ¨', category: 'super_reactions', btnClass: 'btn-gold', arg: 'money_rain'},
            {id: 'reaction_nuke', type: 'reaction_buy', action: 'buySuperReaction', price: 500, name: 'Ù‚ØµÙ (Nuke)', icon: 'â˜¢ï¸', sub: 'Ù‡Ø²Ø© Ø£Ø±Ø¶ÙŠØ©', category: 'super_reactions', btnClass: 'btn-danger', arg: 'nuke'}
        ];

        function getBannerUrl(bannerId) {
            const item = shopItemsList.find(i => i.id === bannerId);
            return item ? item.bgImage : null;
        }

        if(!user) document.getElementById('authModal').style.display = 'flex';

        async function auth() {
            const name = document.getElementById('uName').value.trim();
            const pass = document.getElementById('uPass').value.trim();
            if(!name || !pass) return alert('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©');
            const ref = db.collection('users').doc(name);
            const doc = await ref.get();
            if(doc.exists) {
                if(doc.data().password !== pass) return alert('Ø®Ø·Ø£ ÙÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
            } else {
                await ref.set({ 
                    password: pass, points: 50, xp: 0, level: 1,
                    displayName: name, activeBadge: null, 
                    activeFrame: null, activePostBg: null, activeBanner: null,
                    activeNameGradient: null,
                    activeSiteTheme: null, activePet: null, activeTextStyle: null,
                    inventory: [], following: [], followers: [],
                    xpBoosterExpires: null, isVerified: false, ghostMode: false,
                    avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`, 
                    createdAt: new Date(), lastSeen: new Date()
                });
                await logTransaction(name, 50, 'bonus', 'Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
            }
            localStorage.setItem('uName', name);
            location.reload();
        }

        function logout() { localStorage.removeItem('uName'); location.reload(); }

        async function loadUser() {
            if(!user) return;
            // Admin Check for Youssef
            if(user === SUPER_ADMIN) {
                document.getElementById('superAdminEditBtn').style.display = 'block';
            }

            setInterval(() => { db.collection('users').doc(user).update({ lastSeen: new Date() }); }, 60000);
            db.collection('users').doc(user).update({ lastSeen: new Date() });
            
            db.collection('system').doc('shoutout').onSnapshot(doc => {
                const container = document.getElementById('globalShoutoutContainer');
                if(doc.exists && doc.data().activeUntil && doc.data().activeUntil.toDate() > new Date()) {
                    container.style.display = 'flex';
                    document.getElementById('shoutoutText').innerHTML = `ğŸ“¢ ${doc.data().text} (Ù…Ù†: ${doc.data().user})`;
                } else {
                    container.style.display = 'none';
                }
            });

            if(ADMINS.includes(user)) {
                document.getElementById('adminBtn').style.display = 'inline-flex';
                document.getElementById('adminContestControls').style.display = 'block';
                document.getElementById('supportChatContainer').classList.add('admin-mode');
                renderAdminUserList(); 
            } else {
                document.getElementById('supportChatContainer').classList.add('user-mode');
                initSupportSystem(); 
            }

            db.collection('users').doc(user).onSnapshot(doc => {
                if(!doc.exists) return logout();
                userData = doc.data();
                document.getElementById('pts').innerText = formatNumber(userData.points) + 'ğŸ’°';
                const avatarEl = document.getElementById('uAvatar');
                avatarEl.src = userData.avatar;
                avatarEl.className = ""; 
                if(userData.activeFrame) avatarEl.classList.add(userData.activeFrame);
                if(userData.activeBadge === 'effect_lightning') avatarEl.classList.add('effect_lightning');
                const currentXP = userData.xp || 0;
                const level = Math.floor(Math.sqrt(currentXP / 100)) + 1;
                document.getElementById('uLevelBadge').innerText = `Lvl ${level}`;
                if(userData.inventory?.includes('effect_trail')) handleNeonTrail();
                
                applySiteTheme(userData.activeSiteTheme);

                checkDailyBonus();
                // Render UI is called after fetching shop items
                
                if(userData.inventory?.includes('license_ghost')) {
                    document.getElementById('ghostModeControl').style.display = 'flex';
                    document.getElementById('ghostSwitch').checked = userData.ghostMode || false;
                }
                if(userData.inventory?.includes('unlock_anthem')) {
                    document.getElementById('anthemControl').style.display = 'block';
                    document.getElementById('anthemUrl').value = userData.profileAnthem || '';
                }
                if(userData.inventory?.includes('item_rename_card')) {
                    document.getElementById('btnUseRename').style.display = 'block';
                } else {
                    document.getElementById('btnUseRename').style.display = 'none';
                }
            });

            // Initialize Shop Data
            await initShopData();
        }
        
        // --- SHOP EDIT & DYNAMIC RENDERING SYSTEM ---

        async function initShopData() {
            // Check if DB is seeded
            const snapshot = await db.collection('shop_items').get();
            if (snapshot.empty) {
                // Seed DB
                const batch = db.batch();
                initialShopItems.forEach(item => {
                    const ref = db.collection('shop_items').doc(item.id);
                    batch.set(ref, item);
                });
                await batch.commit();
                console.log("DB Seeded");
            }

            // Listen for real-time updates
            db.collection('shop_items').onSnapshot(snap => {
                shopItemsList = [];
                snap.forEach(doc => shopItemsList.push(doc.data()));
                renderShopUI();
            });
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('superAdminEditBtn');
            const header = document.getElementById('shopHeader');
            if(isEditMode) {
                btn.innerText = "ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
                header.style.display = 'block';
                document.body.classList.add('edit-mode-active');
            } else {
                btn.innerText = "ğŸ› ï¸ ÙˆØ¶Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø± (Ø¥ÙŠÙ‚Ø§Ù/ØªØ´ØºÙŠÙ„)";
                header.style.display = 'none';
                document.body.classList.remove('edit-mode-active');
            }
            renderShopUI();
            document.getElementById('adminPanel').style.display='none';
            switchTab('shop');
        }

        async function editShopItem(item) {
            const newName = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…:", item.name);
            if(newName === null) return;
            const newPrice = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±:", item.price);
            if(newPrice === null) return;

            const parsedPrice = parseInt(newPrice);
            if(isNaN(parsedPrice)) return alert("Ø§Ù„Ø³Ø¹Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ù‚Ù…Ø§Ù‹");

            await db.collection('shop_items').doc(item.id).update({
                name: newName,
                price: parsedPrice
            });
            notify("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø¬Ø§Ø­! ğŸ”„");
        }

        function renderShopUI() {
            const container = document.getElementById('dynamicShopContainer');
            container.innerHTML = '';
            
            // Group Items by Category to maintain layout
            const categories = {
                'themes': 'ğŸ–¼ï¸ Ø«ÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹',
                'styles': 'ğŸ¨ Ø®Ø·ÙˆØ· ÙˆÙ†ØµÙˆØµ',
                'pets': 'ğŸ¾ Ù…Ø±Ø§ÙÙ‚ÙŠÙ†',
                'consumables': 'âœ¨ Ù…Ø³ØªÙ‡Ù„ÙƒØ§Øª ÙˆØ£Ø¯ÙˆØ§Øª',
                'reactions': 'ğŸ­ ØªÙØ§Ø¹Ù„Ø§Øª ÙˆØµÙˆØªÙŠØ§Øª',
                'winter': 'â„ï¸ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø´ØªØ§Ø¡',
                'banners': 'ğŸŒ† Ø¨Ù†Ø±Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„',
                'special': 'ğŸ’ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù…ÙŠØ²',
                'boxes': 'ğŸ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø­Ø¸',
                'neon': 'âš¡ Ø¹Ø§Ù„Ù… Ø§Ù„Ù†ÙŠÙˆÙ†',
                'neon_frames': 'ğŸŒ€ Ø¥Ø·Ø§Ø±Ø§Øª Ù†ÙŠÙˆÙ† Ù…ØªØ­Ø±ÙƒØ©',
                'classic': 'ğŸ›¡ï¸ Ø§Ù„Ø£Ù„Ù‚Ø§Ø¨ ÙˆØ§Ù„Ø¥Ø·Ø§Ø±Ø§Øª',
                'super_reactions': 'ğŸ§¨ ØªÙØ§Ø¹Ù„Ø§Øª Ø®Ø§Ø±Ù‚Ø©'
            };

            for (const [catKey, catTitle] of Object.entries(categories)) {
                const items = shopItemsList.filter(i => i.category === catKey);
                if(items.length === 0) continue;

                const sectionDiv = document.createElement('div');
                sectionDiv.innerHTML = `<h3 class="shop-section-title">${catTitle}</h3>`;
                const gridDiv = document.createElement('div');
                gridDiv.className = 'shop-grid';

                items.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'shop-item';
                    if(item.border) itemEl.style.borderColor = item.border;

                    // Build Visual Preview
                    let visualHTML = '';
                    if(item.bgImage) visualHTML = `<div class="shop-banner-preview" style="background-image:url('${item.bgImage}')"></div>`;
                    else if(item.cssPreview) visualHTML = `<div style="margin:5px auto; ${item.cssPreview}"></div>`;
                    else if(item.previewBadge) visualHTML = `<span class="shop-badge-preview" style="background:${item.previewBg}; color:${item.previewColor};">${item.previewBadge}</span>`;
                    else if(item.icon) {
                        if(item.iconStyle) visualHTML = `<div style="${item.iconStyle}">${item.icon}</div>`;
                        else visualHTML = `<div style="font-size:24px;">${item.icon}</div>`;
                    } else if(item.className) visualHTML = `<h4 class="${item.className}" style="margin:5px 0;">Sample</h4>`;

                    // Build Subtext
                    let subHTML = item.sub ? `<div style="font-size:10px; color:var(--text-muted)">${item.sub}</div>` : '';

                    // Button Logic
                    let btnHTML = '';
                    if(isEditMode) {
                        btnHTML = `<button onclick='editShopItem(${JSON.stringify(item)})' class="btn-danger btn-xs" style="width:100%">âœï¸ ØªØ¹Ø¯ÙŠÙ„ (${item.price}ğŸ’°)</button>`;
                    } else {
                        // Standard Shop Logic
                        const inventory = userData.inventory || [];
                        const isOwned = inventory.includes(item.id);
                        const isVerified = item.id === 'sub_verified' && userData.isVerified;
                        let isActive = false;
                         // Check active state
                        if(item.type === 'gradient' && userData.activeNameGradient === item.id) isActive = true;
                        if(item.type === 'badge' && userData.activeBadge === item.id) isActive = true;
                        if(item.type === 'frame' && userData.activeFrame === item.id) isActive = true;
                        if(item.type === 'banner' && userData.activeBanner === item.id) isActive = true;
                        if(item.type === 'site_theme' && userData.activeSiteTheme === item.id) isActive = true;
                        if(item.type === 'pet' && userData.activePet === item.id) isActive = true;
                        if(item.type === 'text_style' && userData.activeTextStyle === item.id) isActive = true;
                        if(item.id === 'sub_verified' && userData.isVerified) isActive = true;

                        if (item.type === 'consumable' || item.type === 'action' || item.type === 'box' || item.type === 'reaction_buy') {
                             if(item.type === 'consumable') {
                                 const count = inventory.filter(i => i === item.id).length;
                                 let btnTxt = count > 0 ? `Ù„Ø¯ÙŠÙƒ (${count})` : `Ø´Ø±Ø§Ø¡ (${item.price}ğŸ’°)`;
                                 let clickFn = `purchaseItem('${item.id}', ${item.price}, 'consumable')`;
                                 btnHTML = `<button onclick="${clickFn}" class="${item.btnClass}">${btnTxt}</button>`;
                             } else if (item.type === 'action') {
                                 btnHTML = `<button onclick="${item.action}()" class="${item.btnClass}">Ø´Ø±Ø§Ø¡ (${item.price}ğŸ’°)</button>`;
                             } else if (item.type === 'reaction_buy') {
                                 btnHTML = `<button onclick="${item.action}('${item.arg}', ${item.price})" class="${item.btnClass}">Ø´Ø±Ø§Ø¡ (${item.price}ğŸ’°)</button>`;
                             } else if (item.type === 'box') {
                                 btnHTML = `<button onclick="openMysteryBox('${item.boxType}', ${item.price})" class="${item.btnClass}">ÙØªØ­ (${item.price}ğŸ’°)</button>`;
                             }
                        } else {
                            if(isActive) {
                                btnHTML = `<button disabled class="btn-owned">Ù…Ø³ØªØ®Ø¯Ù… âœ…</button>`;
                            } else if (isOwned) {
                                if (item.type === 'permanent' || item.type === 'subscription') {
                                    btnHTML = `<button disabled class="btn-owned">Ù…Ù…Ù„ÙˆÙƒ âœ…</button>`;
                                } else {
                                    btnHTML = `<button onclick="equipItem('${item.id}', '${item.type}')" class="btn-success">ØªÙØ¹ÙŠÙ„ ğŸ› ï¸</button>`;
                                }
                            } else {
                                btnHTML = `<button onclick="purchaseItem('${item.id}', ${item.price}, '${item.type}')" class="${item.btnClass}">${item.price}ğŸ’°</button>`;
                            }
                        }
                    }

                    itemEl.innerHTML = `
                        ${visualHTML}
                        <h4 style="margin:5px 0; ${item.className ? '' : ''}">${item.name}</h4>
                        ${subHTML}
                        ${btnHTML}
                    `;
                    gridDiv.appendChild(itemEl);
                });

                sectionDiv.appendChild(gridDiv);
                container.appendChild(sectionDiv);
            }
        }

        // --- End of Dynamic Shop Logic ---

        function applySiteTheme(theme) {
            if (matrixInterval) clearInterval(matrixInterval);
            const mCanvas = document.getElementById('matrixCanvas');
            const sBg = document.getElementById('spaceBg');
            
            mCanvas.style.display = 'none';
            sBg.style.display = 'none';
            sBg.innerHTML = ''; 

            if(theme === 'theme_matrix') {
                mCanvas.style.display = 'block';
                startMatrixEffect();
            } else if(theme === 'theme_space') {
                sBg.style.display = 'block';
                startSpaceEffect();
            }
        }

        function startMatrixEffect() {
            const canvas = document.getElementById('matrixCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const katakana = 'ã‚¢ã‚¡ã‚«ã‚µã‚¿ãƒŠãƒãƒãƒ¤ãƒ£ãƒ©ãƒ¯ã‚¬ã‚¶ãƒ€ãƒãƒ‘ã‚¤ã‚£ã‚­ã‚·ãƒãƒ‹ãƒ’ãƒŸãƒªãƒ°ã‚®ã‚¸ãƒ‚ãƒ“ãƒ”ã‚¦ã‚¥ã‚¯ã‚¹ãƒ„ãƒŒãƒ•ãƒ ãƒ¦ãƒ¥ãƒ«ã‚°ã‚ºãƒ–ãƒ…ãƒ—ã‚¨ã‚§ã‚±ã‚»ãƒ†ãƒãƒ˜ãƒ¡ãƒ¬ãƒ±ã‚²ã‚¼ãƒ‡ãƒ™ãƒšã‚ªã‚©ã‚³ã‚½ãƒˆãƒãƒ›ãƒ¢ãƒ¨ãƒ§ãƒ­ãƒ²ã‚´ã‚¾ãƒ‰ãƒœãƒ1234567890';
            const letters = katakana.split('');
            const fontSize = 16;
            const columns = canvas.width / fontSize;
            const drops = Array(Math.floor(columns)).fill(1);

            function draw() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#0F0';
                ctx.font = fontSize + 'px monospace';
                for(let i=0; i<drops.length; i++) {
                    const text = letters[Math.floor(Math.random()*letters.length)];
                    ctx.fillText(text, i*fontSize, drops[i]*fontSize);
                    if(drops[i]*fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                    drops[i]++;
                }
            }
            matrixInterval = setInterval(draw, 33);
        }

        function startSpaceEffect() {
            const container = document.getElementById('spaceBg');
            for(let i=0; i<100; i++) {
                const s = document.createElement('div');
                s.className = 'space-star';
                const size = Math.random() * 3 + 'px';
                s.style.width = size; s.style.height = size;
                s.style.left = Math.random() * 100 + 'vw';
                s.style.top = Math.random() * 100 + 'vh';
                s.style.animationDuration = Math.random() * 3 + 2 + 's';
                container.appendChild(s);
            }
        }

        async function buyShoutout() {
            const price = 5000;
            if(userData.points < price) return alert('ØªØ­ØªØ§Ø¬ 5000ğŸ’°');
            const msg = prompt("Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ (Ø³ØªØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹):");
            if(!msg) return;
            if(!confirm("Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù…Ø¯Ø© Ø³Ø§Ø¹Ø©ØŸ")) return;
            
            const until = new Date(); until.setHours(until.getHours() + 1);
            
            const batch = db.batch();
            batch.update(db.collection('users').doc(user), { points: firebase.firestore.FieldValue.increment(-price) });
            batch.set(db.collection('system').doc('shoutout'), { text: msg, user: user, activeUntil: until });
            
            await batch.commit(); 
            notify("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±! ğŸ“¢");
        }

        let trailActive = false;
        function handleNeonTrail() {
            if(trailActive) return;
            trailActive = true;
            const createParticle = (x, y) => {
                const p = document.createElement('div');
                p.classList.add('neon-particle');
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 1000);
            };
            document.addEventListener('mousemove', (e) => { createParticle(e.clientX, e.clientY); });
            document.addEventListener('touchmove', (e) => { const touch = e.touches[0]; createParticle(touch.clientX, touch.clientY); }, {passive: true});
        }

        async function openMysteryBox(boxType, price) {
            if(userData.points < price) return alert("Ù†Ù‚Ø§Ø·Ùƒ Ù„Ø§ ØªÙƒÙÙŠ!");
            if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ÙØªØ­ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù…Ù‚Ø§Ø¨Ù„ ${price}ØŸ`)) return;

            const batch = db.batch();
            const userRef = db.collection('users').doc(user);
            batch.update(userRef, { points: firebase.firestore.FieldValue.increment(-price) });
            await batch.commit();

            const roll = Math.random();
            let prizeMsg = "";
            let win = false;

            if (boxType === 'mystery') {
                if(roll < 0.4) { prizeMsg = "Ù„Ù„Ø£Ø³ÙØŒ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙØ§Ø±Øº! ğŸ’¨"; }
                else if(roll < 0.7) { 
                    const pts = 1000; 
                    await db.collection('users').doc(user).update({ points: firebase.firestore.FieldValue.increment(pts) });
                    prizeMsg = `Ø±Ø¨Ø­Øª 1000 Ù†Ù‚Ø·Ø©! ğŸ’°`; win = true;
                } else if (roll < 0.9) {
                     const frames = ['frame_neon', 'frame_gold'];
                     const prize = frames[Math.floor(Math.random()*frames.length)];
                     await db.collection('users').doc(user).update({ inventory: firebase.firestore.FieldValue.arrayUnion(prize) });
                     prizeMsg = `Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø¥Ø·Ø§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ! ğŸ‰`; win = true;
                } else {
                    const pts = 5000;
                    await db.collection('users').doc(user).update({ points: firebase.firestore.FieldValue.increment(pts) });
                    prizeMsg = `Ø¬Ø§ÙƒØ¨ÙˆØª! Ø±Ø¨Ø­Øª 5000 Ù†Ù‚Ø·Ø©! ğŸ’`; win = true;
                }
            } else if (boxType === 'avatar') {
                if(roll < 0.5) {
                    await db.collection('users').doc(user).update({ points: firebase.firestore.FieldValue.increment(2000) });
                    prizeMsg = "Ù„Ù… ÙŠØ­Ø§Ù„ÙÙƒ Ø§Ù„Ø­Ø¸ Ø¨Ø§Ù„Ø£ÙØ§ØªØ§Ø±ØŒ Ø§Ø³ØªØ¹Ø¯Øª 2000 Ù†Ù‚Ø·Ø©.";
                } else {
                    await db.collection('users').doc(user).update({ inventory: firebase.firestore.FieldValue.arrayUnion('frame_wormhole') });
                    prizeMsg = "Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø¥Ø·Ø§Ø± Ø§Ù„Ø«Ù‚Ø¨ Ø§Ù„Ø¯ÙˆØ¯ÙŠ Ø§Ù„Ù†Ø§Ø¯Ø±!"; win = true;
                }
            }
            alert(prizeMsg);
            if(win) notify(prizeMsg);
        }

        async function buySuperReaction(type, price) {
            alert("Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø£ÙŠ Ù…Ù†Ø´ÙˆØ± ÙˆØ§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ù‡Ù†Ø§Ùƒ!");
        }

        async function triggerSuperReaction(postId, authorId, type, cost) {
            if(userData.points < cost) return alert(`ØªØ­ØªØ§Ø¬ ${cost} Ù†Ù‚Ø·Ø©!`);
            if(!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… ${type} Ù…Ù‚Ø§Ø¨Ù„ ${cost}ØŸ`)) return;

            try {
                await db.runTransaction(async (t) => {
                    const userRef = db.collection('users').doc(user);
                    const authorRef = db.collection('users').doc(authorId);
                    t.update(userRef, { points: firebase.firestore.FieldValue.increment(-cost) });
                    if(type === 'money_rain') {
                        t.update(authorRef, { points: firebase.firestore.FieldValue.increment(50) });
                    }
                });

                if(type === 'money_rain') {
                    for(let i=0; i<30; i++) {
                        const bill = document.createElement('div'); bill.innerText = 'ğŸ’µ'; bill.className = 'money-rain-bill';
                        bill.style.left = Math.random() * 100 + 'vw'; bill.style.animationDuration = (Math.random() * 2 + 1) + 's';
                        document.body.appendChild(bill); setTimeout(() => bill.remove(), 3000);
                    }
                    notify(`Ø£Ù…Ø·Ø±Øª Ø§Ù„Ù…Ø§Ù„ Ø¹Ù„Ù‰ ${authorId}!`);
                } else if (type === 'nuke') {
                    document.body.classList.add('nuke-shake'); setTimeout(() => document.body.classList.remove('nuke-shake'), 600); notify(`BOOM! â˜¢ï¸`);
                }
            } catch(e) { console.error(e); alert("Ø­Ø¯Ø« Ø®Ø·Ø£"); }
        }

        async function purchaseItem(itemId, price, type) {
            if(userData.points < price) return alert('Ù†Ù‚Ø§Ø·Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠØ©!');
            if(!confirm(`Ø´Ø±Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ù‚Ø§Ø¨Ù„ ${price} Ù†Ù‚Ø·Ø©ØŸ`)) return;
            const batch = db.batch();
            const userRef = db.collection('users').doc(user);
            batch.update(userRef, { points: firebase.firestore.FieldValue.increment(-price) });
            
            if(type === 'subscription' && itemId === 'sub_verified') { batch.update(userRef, { isVerified: true }); } 
            else { batch.update(userRef, { inventory: firebase.firestore.FieldValue.arrayUnion(itemId) }); }

            if(type === 'consumable' && itemId === 'booster_xp') {
                 const expires = new Date(); expires.setHours(expires.getHours() + 24);
                 batch.update(userRef, { xpBoosterExpires: expires, inventory: firebase.firestore.FieldValue.arrayRemove('booster_xp') });
                 notify('ØªÙ… Ø´Ø±Ø§Ø¡ ÙˆØªÙØ¹ÙŠÙ„ Ù…Ø¹Ø²Ø² XP Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø©!');
            }
            await batch.commit();
            await logTransaction(user, -price, 'shop_buy', `Ø´Ø±Ø§Ø¡ ${itemId}`);
            renderShopUI();
            notify('ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­');
            if(itemId === 'effect_trail') location.reload();
        }
        
        async function useRenameCard() {
            const newName = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
            if(!newName || newName.length < 3) return alert("Ø§Ù„Ø§Ø³Ù… Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹");
            const check = await db.collection('users').doc(newName).get();
            if(check.exists) return alert("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!");
            if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ùƒ Ø¥Ù„Ù‰ ${newName}ØŸ Ø³ÙŠØªÙ… Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©.`)) return;
            const batch = db.batch();
            const userRef = db.collection('users').doc(user);
            batch.update(userRef, { displayName: newName, inventory: firebase.firestore.FieldValue.arrayRemove('item_rename_card') });
            await batch.commit(); notify("ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­!"); location.reload();
        }

        async function equipItem(itemId, type) {
            let updates = {};
            if (type === 'gradient') { updates.activeNameGradient = itemId; }
            if (type === 'badge') updates.activeBadge = itemId;
            if (type === 'frame') updates.activeFrame = itemId;
            if (type === 'banner') updates.activeBanner = itemId;
            if (type === 'post_bg') updates.activePostBg = itemId;
            if (type === 'site_theme') updates.activeSiteTheme = itemId; 
            if (type === 'pet') updates.activePet = itemId; 
            if (type === 'text_style') updates.activeTextStyle = itemId; 

            await db.collection('users').doc(user).update(updates);
            notify('ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
        }

        function getPetEmoji(petId) {
            if(petId === 'pet_bot') return 'ğŸ¤–';
            if(petId === 'pet_cat') return 'ğŸ±';
            if(petId === 'pet_ghost') return 'ğŸ‘»';
            return '';
        }

        async function loadFeed() {
            const feed = document.getElementById('feed');
            feed.innerHTML = '<div class="loader" style="border-color:var(--accent)"></div>';
            const snap = await db.collection('prompts').orderBy('createdAt', 'desc').limit(50).get();
            feed.innerHTML = '';
            let posts = [];
            snap.forEach(doc => posts.push({id: doc.id, ...doc.data()}));
            
            if(feedFilter === 'following') {
                const myFollowing = userData.following || [];
                if(myFollowing.length === 0) { feed.innerHTML = '<div style="padding:20px; text-align:center;">Ù„Ø§ ØªØªØ§Ø¨Ø¹ Ø£Ø­Ø¯Ø§Ù‹.</div>'; return; }
                posts = posts.filter(p => myFollowing.includes(p.author));
            }

            posts.sort((a,b) => {
                const aFeat = (a.featuredUntil && a.featuredUntil.toDate() > new Date());
                const bFeat = (b.featuredUntil && b.featuredUntil.toDate() > new Date());
                if (aFeat && !bFeat) return -1; if (!aFeat && bFeat) return 1;
                const aPinned = (a.isPinned) || (a.pinnedUntil && a.pinnedUntil.toDate() > new Date());
                const bPinned = (b.isPinned) || (b.pinnedUntil && b.pinnedUntil.toDate() > new Date());
                return (bPinned ? 1 : 0) - (aPinned ? 1 : 0);
            });

            const isAdmin = ADMINS.includes(user);
            const hasReactionsPack = userData.inventory?.includes('pack_reactions');

            posts.forEach(p => {
                const isLocked = p.type === 'paid' && p.author !== user && !p.buyers?.includes(user);
                const isUserPinned = p.pinnedUntil && p.pinnedUntil.toDate() > new Date();
                const isFeatured = p.featuredUntil && p.featuredUntil.toDate() > new Date();
                const hasPinTicket = userData.inventory?.includes('ticket_featured'); 
                const followBtn = (p.author !== user) ? `<button onclick="toggleFollow('${p.author}')" class="btn-xs btn-outline" style="margin-right:5px; font-size:10px; padding:2px 8px;">Ù…ØªØ§Ø¨Ø¹Ø©</button>` : '';

                let textStyleClass = p.textStyle ? p.textStyle : "";

                let contentHtml = escapeHtml(p.content);
                if(contentHtml.includes('def ') || contentHtml.includes('const ') || contentHtml.includes('function')) {
                    contentHtml = `<pre><code class="language-python">${contentHtml}</code></pre>`;
                } else {
                    contentHtml = `<div class="${textStyleClass}" style="white-space:pre-wrap">${contentHtml}</div>`;
                }

                let nameClass = p.authorGradient ? p.authorGradient : "";
                let postStyleClass = p.postStyle ? "post-style-" + p.postStyle.replace("post_", "") : "";
                
                let reactionBtns = `<button onclick="toggleReaction('${p.id}', 'like')" class="btn-icon">â¤ï¸ ${p.likes || 0}</button>`;
                if(hasReactionsPack) {
                     reactionBtns += `<button onclick="toggleReaction('${p.id}', 'fire')" class="btn-icon">ğŸ”¥ ${p.reactions?.fire?.length || 0}</button><button onclick="toggleReaction('${p.id}', 'rocket')" class="btn-icon">ğŸš€ ${p.reactions?.rocket?.length || 0}</button><button onclick="toggleReaction('${p.id}', 'poop')" class="btn-icon">ğŸ’© ${p.reactions?.poop?.length || 0}</button>`;
                }
                
                let avatarClass = p.authorFrame || '';
                if(p.authorBadge === 'effect_lightning') avatarClass += ' effect_lightning';
                let petHtml = p.authorPet ? `<span class="user-pet">${getPetEmoji(p.authorPet)}</span>` : '';

                let superBtns = `
                    <button onclick="triggerSuperReaction('${p.id}', '${p.author}', 'money_rain', 100)" class="btn-icon" title="Ù…Ø·Ø± Ø§Ù„Ø£Ù…ÙˆØ§Ù„ (100)">ğŸ’¸</button>
                    <button onclick="triggerSuperReaction('${p.id}', '${p.author}', 'nuke', 500)" class="btn-icon" title="Ù‚ØµÙ (500)">â˜¢ï¸</button>
                `;

                let commentSection = `
                    <div style="margin-top:10px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
                        <button onclick="toggleComments('${p.id}')" class="btn-xs btn-outline">ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</button>
                        <div id="comments-${p.id}" class="postui-comment-section">
                            <div id="comments-list-${p.id}"></div>
                            <div style="display:flex; gap:5px; margin-top:5px;">
                                <input id="comment-input-${p.id}" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹..." style="margin:0; height:30px; font-size:12px;">
                                <button onclick="sendComment('${p.id}')" class="btn-xs btn-blue">Ù†Ø´Ø±</button>
                            </div>
                        </div>
                    </div>
                `;

                feed.innerHTML += `
                    <div class="post ${p.isHighlight ? 'highlighted' : ''} ${isFeatured ? 'featured' : ''} ${postStyleClass}">
                        ${(p.isPinned || isUserPinned) ? '<div class="pinned-badge">ğŸ“Œ Ù…Ø«Ø¨Øª</div>' : ''}
                        ${isFeatured ? '<div class="featured-badge">ğŸš€ Ù…Ù…ÙŠØ²</div>' : ''}
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <div style="display:flex; gap:10px; align-items:center;">
                                <img src="${p.authorImg}" class="${avatarClass}" style="width:40px; height:40px; border-radius:50%; border:1px solid var(--glass-border); cursor:pointer;" onclick="openProfileModal('${p.author}')">
                                <div>
                                    <div style="display:flex; align-items:center; gap:5px; flex-wrap:wrap;">
                                        ${petHtml}
                                        ${p.authorBadge ? getBadgeHtml(p.authorBadge) : ''}
                                        <b class="${nameClass}">${p.author}</b>
                                        ${p.authorVerified ? '<span class="verified-tick">â˜‘ï¸</span>' : ''}
                                        ${followBtn} </div>
                                    <div style="font-size:11px; opacity:0.7;">${p.type === 'paid' ? `ğŸ’° ${p.price}` : 'Ù…Ø¬Ø§Ù†ÙŠ'}</div>
                                </div>
                            </div>
                        </div>
                        <h4 style="margin:15px 0 10px 0; font-size:16px;">${p.title}</h4>
                        ${isLocked ? `<div style="background:rgba(0,0,0,0.3); padding:20px; text-align:center;"><button onclick="buyPrompt('${p.id}', '${p.author}', ${p.price})" class="btn-gold">Ø´Ø±Ø§Ø¡ (${p.price}ğŸ’°)</button></div>` : `<div class="content-box" id="post-content-${p.id}">${contentHtml}</div>${p.postImg ? `<img src="${p.postImg}" class="post-img" onclick="window.open(this.src)">` : ''}`}
                        <div class="post-actions" style="margin-top:10px; display:flex; gap:5px; flex-wrap:wrap;">
                            ${reactionBtns}
                            ${superBtns}
                            ${!isLocked ? `<button onclick="copyContent('${p.id}')" class="btn-icon" style="font-size:11px;">ğŸ“‹ Ù†Ø³Ø®</button>` : ''}
                            ${p.author === user ? `
                                <button onclick="nominatePrompt('${p.id}', '${p.title}')" class="btn-gold" style="font-size:11px;">ğŸ† ØªØ±Ø´ÙŠØ­ (50ğŸ’°)</button>
                                ${hasPinTicket ? `<button onclick="pinPostByUser('${p.id}', 'feat')" class="btn-blue" style="font-size:11px;">ğŸš€ ØªÙ…ÙŠÙŠØ²</button>` : ''}
                            ` : ''}
                        </div>
                        ${commentSection}
                        ${(isAdmin || p.author === user) ? `<div class="admin-controls" style="margin-top:10px; border-top:1px solid rgba(255,255,255,0.1); padding-top:5px;"><button onclick="deletePost('${p.id}')" class="btn-icon" style="color:var(--danger); font-size:11px">Ø­Ø°Ù</button>${isAdmin ? `<button onclick="togglePin('${p.id}', ${p.isPinned})" class="btn-icon" style="font-size:11px">${p.isPinned ? 'Ø¥Ù„ØºØ§Ø¡' : 'ØªØ«Ø¨ÙŠØª Ø¥Ø¯Ø§Ø±ÙŠ'}</button>` : ''}</div>` : ''}
                    </div>`;
            });
            Prism.highlightAll(); 
        }

        function toggleComments(postId) {
            const section = document.getElementById(`comments-${postId}`);
            if (section.style.display === 'block') { section.style.display = 'none'; } 
            else { section.style.display = 'block'; loadComments(postId); }
        }

        function loadComments(postId) {
            const list = document.getElementById(`comments-list-${postId}`);
            list.innerHTML = '<div class="loader"></div>';
            db.collection('prompts').doc(postId).collection('comments').orderBy('createdAt', 'asc').limit(20)
                .onSnapshot(snapshot => {
                    list.innerHTML = '';
                    if (snapshot.empty) { list.innerHTML = '<div style="font-size:10px; opacity:0.5;">ÙƒÙ† Ø£ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù‚ÙŠÙ†...</div>'; return; }
                    snapshot.forEach(doc => {
                        const c = doc.data(); list.innerHTML += `<div class="comment-item"><b>${c.author}:</b> ${escapeHtml(c.text)}</div>`;
                    });
                });
        }

        async function sendComment(postId) {
            const input = document.getElementById(`comment-input-${postId}`); const text = input.value.trim(); if (!text) return;
            await db.collection('prompts').doc(postId).collection('comments').add({ text: text, author: user, createdAt: new Date() });
            input.value = '';
        }

        function resizeImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width; let height = img.height; const maxSize = 800; 
                        if (width > height) { if (width > maxSize) { height *= maxSize / width; width = maxSize; } } 
                        else { if (height > maxSize) { width *= maxSize / height; height = maxSize; } }
                        canvas.width = width; canvas.height = height;
                        const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7)); 
                    }; img.src = e.target.result;
                }; reader.readAsDataURL(file);
            });
        }

        async function publish() {
            const title = document.getElementById('pTitle').value.trim();
            const content = document.getElementById('pContent').value.trim();
            const type = document.getElementById('pType').value;
            const isHighlight = document.getElementById('pHighlight').checked;
            const file = document.getElementById('pImgFile').files[0];
            const btn = document.getElementById('publishBtn');

            if(!title || (!content && !file)) return alert('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰.');
            
            let totalCost = 5; if(isHighlight && !window.freeHighlightWon) totalCost += 50; 
            if(userData.points < totalCost) return alert(`Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ.`);
            
            let price = 0; if(type === 'paid') { price = parseInt(document.getElementById('pPrice').value); if(!price || price < 10) return alert('Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø¯Ù†Ù‰ 10'); }

            btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";
            let base64Img = null; if(file) base64Img = await resizeImage(file);
            let xpGain = 10; if (userData.xpBoosterExpires && userData.xpBoosterExpires.toDate() > new Date()) xpGain = 20; 

            const batch = db.batch();
            batch.update(db.collection('users').doc(user), { points: firebase.firestore.FieldValue.increment(-totalCost), xp: firebase.firestore.FieldValue.increment(xpGain) });
            const newPostRef = db.collection('prompts').doc();
            
            const postData = {
                title, content: content || "ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø© ğŸ“·", type, price, 
                author: user, authorImg: userData.avatar, 
                authorGradient: userData.activeNameGradient || null,
                authorBadge: userData.activeBadge || null, authorFrame: userData.activeFrame || null, authorVerified: userData.isVerified || false,
                authorPet: userData.activePet || null,
                textStyle: userData.activeTextStyle || null, 
                postStyle: userData.activePostBg || null, 
                postImg: base64Img,
                isHighlight: isHighlight, likes: 0, likedBy: [], reactions: { fire: [], rocket: [], poop: [] }, buyers: [], isPinned: false, createdAt: new Date()
            };

            try {
                batch.set(newPostRef, postData); await batch.commit(); window.freeHighlightWon = false; notify(`ØªÙ… Ø§Ù„Ù†Ø´Ø±! (+${xpGain} XP)`); 
                document.getElementById('pTitle').value = ""; document.getElementById('pContent').value = ""; document.getElementById('pImgFile').value = "";
                document.getElementById('previewImg').style.display = 'none'; switchTab('feed');
            } catch (err) { console.error(err); } finally { btn.disabled = false; btn.innerText = "Ù†Ø´Ø± (+10 XP) ğŸš€"; }
        }

        async function toggleReaction(postId, type) {
            const promptRef = db.collection('prompts').doc(postId);
            const doc = await promptRef.get(); const data = doc.data();
            if (type === 'like') {
                if(data.likedBy?.includes(user)) return;
                await promptRef.update({ likes: firebase.firestore.FieldValue.increment(1), likedBy: firebase.firestore.FieldValue.arrayUnion(user) });
            } else {
                const currentReactions = data.reactions || {}; const usersReacted = currentReactions[type] || [];
                if (usersReacted.includes(user)) return; 
                usersReacted.push(user); currentReactions[type] = usersReacted;
                await promptRef.update({ reactions: currentReactions });
            } loadFeed(); 
        }

        function getBadgeHtml(badgeId) {
            const map = {
                'badge_legend': '<span class="user-badge-display" style="background:#333; color:white;">ğŸ’ Ø§Ù„Ù…Ù„Ùƒ</span>',
                'badge_fire': '<span class="user-badge-display" style="background:#333; color:var(--gold);">ğŸ”¥ Ø§Ù„Ù…ØªÙØ§Ø¹Ù„</span>',
                'badge_pro': '<span class="user-badge-display" style="background:#333; color:var(--accent);">ğŸ›¡ï¸ Ø§Ù„Ù…Ø­ØªØ±Ù</span>',
                'badge_snowman': '<span class="user-badge-display" style="background:linear-gradient(90deg, #a5f3fc, #3b82f6); color:#000;">â˜ƒï¸ Ø±Ø¬Ù„ Ø§Ù„Ø«Ù„Ø¬</span>',
                'effect_lightning': '<span class="user-badge-display" style="background:transparent; border:1px solid var(--accent); color:var(--accent);">âš¡ Ø¨Ø±Ù‚</span>'
            }; return map[badgeId] || '';
        }

        async function openProfileModal(targetUser = null) { 
            let displayUser = userData; let isSelf = true;
            if (targetUser && targetUser !== user) {
                isSelf = false;
                try {
                    const doc = await db.collection('users').doc(targetUser).get();
                    if (!doc.exists) return alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                    displayUser = doc.data();
                    if (displayUser.ghostMode) return alert('ğŸ‘» Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ®ÙÙŠ!');
                } catch (e) { return alert('Ø®Ø·Ø£'); }
            }
            const m = document.getElementById('profileModal'); m.style.display = 'flex'; 
            
            const bannerEl = document.getElementById('pModalBanner');
            const bannerUrl = getBannerUrl(displayUser.activeBanner);
            if (bannerUrl) { bannerEl.style.backgroundImage = `url('${bannerUrl}')`; bannerEl.style.backgroundColor = 'transparent'; } 
            else { bannerEl.style.backgroundImage = 'none'; bannerEl.style.backgroundColor = '#334155'; }

            const statusDot = document.getElementById('pModalStatus');
            const now = new Date(); let isOnline = false;
            
            if (displayUser.lastSeen) {
                const lastSeenDate = displayUser.lastSeen.toDate ? displayUser.lastSeen.toDate() : new Date(displayUser.lastSeen);
                const diffMins = (now - lastSeenDate) / 1000 / 60; if (diffMins < 5) isOnline = true;
            }
            if (displayUser.ghostMode) isOnline = false;
            if (isOnline) { statusDot.className = 'status-dot status-online'; statusDot.title = "Online"; } 
            else { statusDot.className = 'status-dot status-offline'; statusDot.title = "Offline"; }

            document.getElementById('pModalName').innerText = displayUser.displayName || (isSelf ? user : targetUser);
            document.getElementById('pModalName').className = ''; 
            if(displayUser.activeNameGradient) { document.getElementById('pModalName').classList.add(displayUser.activeNameGradient); }

            const pImg = document.getElementById('pModalImg');
            pImg.src = displayUser.avatar; pImg.className = '';
            if(displayUser.activeFrame) pImg.classList.add(displayUser.activeFrame);

            document.getElementById('pModalFollowers').innerText = (displayUser.followers || []).length;
            document.getElementById('pModalFollowing').innerText = (displayUser.following || []).length;
            
            const currentXP = displayUser.xp || 0;
            const level = Math.floor(Math.sqrt(currentXP / 100)) + 1;
            document.getElementById('pModalLvl').innerText = `Lvl ${level}`;
            document.getElementById('xpText').innerText = `${currentXP} XP`;
            const nextLevelXP = Math.pow(level, 2) * 100; const prevLevelXP = Math.pow(level-1, 2) * 100;
            document.getElementById('xpFill').style.width = `${((currentXP - prevLevelXP) / (nextLevelXP - prevLevelXP)) * 100}%`;

            document.getElementById('pModalBadge').innerHTML = displayUser.activeBadge ? getBadgeHtml(displayUser.activeBadge) : '';
            document.getElementById('pModalVerified').style.display = displayUser.isVerified ? 'inline-flex' : 'none';
            document.getElementById('profileMyControls').style.display = isSelf ? 'block' : 'none';
            
            const audio = document.getElementById('profileAudio');
            if (displayUser.profileAnthem && !displayUser.ghostMode) {
                audio.src = displayUser.profileAnthem; audio.volume = 0.5; audio.play().catch(e => console.log("Auto-play blocked", e));
            } else { audio.pause(); audio.src = ""; }
        }

        function closeProfileModal() { const m = document.getElementById('profileModal'); m.style.display = 'none'; const audio = document.getElementById('profileAudio'); audio.pause(); audio.src = ""; }
        
        async function saveProfile() { 
            const p = document.getElementById('editPass').value; 
            const f = document.getElementById('avatarUpload').files[0]; 
            const anthem = document.getElementById('anthemUrl').value.trim();
            let u = {}; if(p) u.password = p; if(anthem) u.profileAnthem = anthem;
            
            if(f) { 
                const maxSize = 11 * 1024 * 1024;
                if(f.size > maxSize) { alert('âš ï¸ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹!'); return; }
                const r = new FileReader(); 
                r.onload = async function(e) { u.avatar = e.target.result; await db.collection('users').doc(user).update(u); notify('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! ğŸ’¾'); location.reload(); }; 
                r.readAsDataURL(f); 
            } else { await db.collection('users').doc(user).update(u); notify('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! ğŸ’¾'); location.reload(); } 
        }

        async function toggleGhostMode() {
            const active = document.getElementById('ghostSwitch').checked;
            await db.collection('users').doc(user).update({ ghostMode: active });
            notify(active ? 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ®ÙÙŠ Ù…ÙØ¹Ù„ ğŸ‘»' : 'ÙˆØ¶Ø¹ Ø§Ù„ØªØ®ÙÙŠ Ù…Ø¹Ø·Ù„');
        }

        async function loadLeaderboard() {
            const board = document.getElementById('leaderboard');
            try {
                const snap = await db.collection('users').orderBy('xp', 'desc').limit(20).get();
                board.innerHTML = '';
                if(snap.empty) { board.innerHTML = '...'; return; }
                let rank = 1, count = 0;
                snap.forEach(doc => {
                    const u = doc.data();
                    if(count >= 5) return; if(u.ghostMode) return; 
                    let rankClass = rank === 1 ? 'rank-1' : (rank === 2 ? 'rank-2' : (rank === 3 ? 'rank-3' : ''));
                    board.innerHTML += `<div class="leaderboard-item"><div class="leaderboard-rank ${rankClass}">${rank===1?'ğŸ¥‡':(rank===2?'ğŸ¥ˆ':(rank===3?'ğŸ¥‰':rank))}</div><img src="${u.avatar}" style="width:30px; height:30px; border-radius:50%; object-fit:cover;"><div style="font-size:12px;"><b>${u.displayName}</b> <span style="color:var(--text-muted)">(${u.xp} XP)</span></div></div>`;
                    rank++; count++;
                });
            } catch(e) { board.innerHTML = 'Need Index'; }
        }

        async function pinPostByUser(postId, type) {
            const ticketName = 'ticket_featured';
            if(!userData.inventory?.includes(ticketName)) return alert('Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„ØªØ°ÙƒØ±Ø©!');
            if(!confirm(`Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ°ÙƒØ±Ø©ØŸ`)) return;
            const expires = new Date(); expires.setHours(expires.getHours() + 24);
            const batch = db.batch();
            batch.update(db.collection('users').doc(user), { inventory: firebase.firestore.FieldValue.arrayRemove(ticketName) });
            batch.update(db.collection('prompts').doc(postId), { featuredUntil: expires }); 
            await batch.commit(); notify('ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„! ğŸš€'); loadFeed();
        }

        function copyContent(id) { const text = document.getElementById(`post-content-${id}`).innerText; navigator.clipboard.writeText(text).then(() => notify('ØªÙ… Ø§Ù„Ù†Ø³Ø®! ğŸ“‹')).catch(() => notify('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', true)); }
        function previewFile() { const f = document.getElementById('pImgFile').files[0]; const p = document.getElementById('previewImg'); if(f) { const r = new FileReader(); r.onload = e => { p.src = e.target.result; p.style.display = 'block'; }; r.readAsDataURL(f); } else { p.style.display = 'none'; } }
        async function toggleFollow(target) { if(target===user)return; const isF = userData.following?.includes(target); const b = db.batch(); const m = db.collection('users').doc(user); const t = db.collection('users').doc(target); if(isF) { b.update(m, {following:firebase.firestore.FieldValue.arrayRemove(target)}); b.update(t, {followers:firebase.firestore.FieldValue.arrayRemove(user)}); notify(`Ø£Ù„ØºÙŠØª Ù…ØªØ§Ø¨Ø¹Ø© ${target}`); } else { b.update(m, {following:firebase.firestore.FieldValue.arrayUnion(target)}); b.update(t, {followers:firebase.firestore.FieldValue.arrayUnion(user)}); notify(`ØªØªØ§Ø¨Ø¹ ${target}`); } await b.commit(); setTimeout(loadFeed, 500); }
        async function voteEntry(id) { const r = db.collection('contest_entries').doc(id); const d = await r.get(); if(d.data().voters?.includes(user)) return; await r.update({votes:firebase.firestore.FieldValue.increment(1), voters:firebase.firestore.FieldValue.arrayUnion(user)}); notify('ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª'); loadContest(); }
        async function nominatePrompt(id, t) { if(userData.points<50) return alert('50ğŸ’°'); if(!confirm('Ø®ØµÙ… 50ØŸ')) return; const c = await db.collection('contest_entries').where('postId','==',id).get(); if(!c.empty) return alert('Ù…ÙˆØ¬ÙˆØ¯'); const b = db.batch(); b.update(db.collection('users').doc(user), {points:firebase.firestore.FieldValue.increment(-50)}); b.set(db.collection('contest_entries').doc(), {postId:id, title:t, nominatedBy:user, votes:0}); await b.commit(); notify('ØªÙ…'); }
        async function buyPrompt(id, s, p) { if(userData.points<p) return alert('ÙÙ‚ÙŠØ±'); const b = db.batch(); b.update(db.collection('prompts').doc(id), {buyers:firebase.firestore.FieldValue.arrayUnion(user)}); b.update(db.collection('users').doc(user), {points:firebase.firestore.FieldValue.increment(-p)}); b.update(db.collection('users').doc(s), {points:firebase.firestore.FieldValue.increment(p)}); await b.commit(); notify('ØªÙ…'); loadFeed(); }
        async function logTransaction(u, a, t, d) { await db.collection('users').doc(u).collection('transactions').add({amount:a, type:t, desc:d, at:new Date()}); }
        function formatNumber(n) { return n>=1000 ? (n/1000).toFixed(1)+'k' : n; }
        function notify(m, e=false) { const n = document.getElementById('notification'); n.innerText = m; n.style.borderColor = e?'var(--danger)':'var(--success)'; n.style.display='block'; setTimeout(()=>n.style.display='none',3000); }
        function escapeHtml(t) { return t.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); }
        function switchTab(id) { document.querySelectorAll('[id^="tab-"]').forEach(e=>e.style.display='none'); document.getElementById('tab-'+id).style.display='block'; document.querySelectorAll('.nav-tab').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); if(id==='feed') loadFeed(); if(id==='contests') loadContest(); }
        
        async function checkDailyBonus() { const l = localStorage.getItem('lastBonus'); if(!l || Date.now()-l > 86400000) document.getElementById('dailyBonusBtn').style.display='inline-flex'; }
        async function claimDailyBonus() { await db.collection('users').doc(user).update({points:firebase.firestore.FieldValue.increment(20)}); localStorage.setItem('lastBonus', Date.now()); notify('20ğŸ’°'); location.reload(); }
        function toggleTheme() { document.body.classList.toggle('light-mode'); }
        async function openAdminPanel() { document.getElementById('adminPanel').style.display='flex'; }
        async function addPointsByAdmin() { const u = document.getElementById('adminTargetUser').value; const p = parseInt(document.getElementById('adminPointsAmount').value); await db.collection('users').doc(u).update({points:firebase.firestore.FieldValue.increment(p)}); notify('ØªÙ…'); }
        function togglePriceInput() { const t = document.getElementById('pType').value; document.getElementById('pPrice').style.display = t === 'paid' ? 'block' : 'none'; }
        function setFeedFilter(m) { feedFilter = m; document.getElementById('filter-all').classList.toggle('active', m==='all'); document.getElementById('filter-following').classList.toggle('active', m==='following'); loadFeed(); }
        function toggleTransferMode() { const e = document.getElementById('transferSection'); e.style.display=e.style.display==='block'?'none':'block'; }
        async function transferPoints() { const r = document.getElementById('transReceiver').value; const a = parseInt(document.getElementById('transAmount').value); if(!r||!a) return; if(userData.points<a) return alert('ÙÙ‚ÙŠØ±'); const b = db.batch(); b.update(db.collection('users').doc(user), {points:firebase.firestore.FieldValue.increment(-a)}); b.update(db.collection('users').doc(r), {points:firebase.firestore.FieldValue.increment(a)}); await b.commit(); notify('ØªÙ…'); toggleTransferMode(); }
        function toggleHistoryMode() { const e = document.getElementById('historySection'); e.style.display=e.style.display==='block'?'none':'block'; if(e.style.display==='block') loadHistory(); }
        async function loadHistory() { const s = await db.collection('users').doc(user).collection('transactions').orderBy('at','desc').limit(20).get(); const d = document.getElementById('historyList'); d.innerHTML=''; s.forEach(doc=>{ const t=doc.data(); d.innerHTML+=`<div style="padding:5px; border-bottom:1px solid #333; display:flex; justify-content:space-between;"><span>${t.desc}</span><span style="color:${t.amount>0?'green':'red'}">${t.amount}</span></div>`; }); }
        async function deletePost(id) { if(!confirm('Ø­Ø°ÙØŸ')) return; await db.collection('prompts').doc(id).delete(); notify('ØªÙ…'); loadFeed(); }
        async function endContest() { if(!ADMINS.includes(user)) return; if(!confirm('Ø¥Ù†Ù‡Ø§Ø¡ØŸ')) return; const s = await db.collection('contest_entries').orderBy('votes','desc').limit(1).get(); if(s.empty) return; const w = s.docs[0].data(); await db.collection('users').doc(w.nominatedBy).update({points:firebase.firestore.FieldValue.increment(500)}); const a = await db.collection('contest_entries').get(); const b = db.batch(); a.forEach(d=>b.delete(d.ref)); await b.commit(); alert(`ÙØ§Ø² ${w.nominatedBy}`); loadContest(); }
        async function togglePin(id, s) { await db.collection('prompts').doc(id).update({isPinned:!s}); notify('ØªÙ…'); loadFeed(); }
        
        async function spinForHighlight() {
            const cost = 10; if(userData.points < cost) return alert('ØªØ­ØªØ§Ø¬ 10ğŸ’°');
            document.getElementById('slotDisplay').style.display = 'flex';
            const btn = document.querySelector('button[onclick="spinForHighlight()"]');
            btn.disabled = true;
            await db.collection('users').doc(user).update({ points: firebase.firestore.FieldValue.increment(-cost) });
            const reels = ['reel1', 'reel2', 'reel3']; const icons = ['ğŸ’', 'ğŸ‹', 'â­', 'ğŸ’', '7ï¸âƒ£']; let results = []; let iterations = 10;
            const spin = setInterval(() => {
                results = []; reels.forEach(id => { const rand = icons[Math.floor(Math.random() * icons.length)]; document.getElementById(id).innerText = rand; results.push(rand); });
                iterations--; if(iterations <= 0) { clearInterval(spin); if(results[0] === results[1] && results[1] === results[2]) { alert("ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ!"); document.getElementById('pHighlight').checked = true; window.freeHighlightWon = true; } else { notify("Ø­Ø¸ Ø£ÙˆÙØ±!"); } btn.disabled = false; }
            }, 100);
        }

        async function askBot() {
            const input = document.getElementById('botInput').value; if(!input) return;
            const history = document.getElementById('botHistory'); const btn = document.getElementById('btnSendBot');
            history.innerHTML += `<div style="text-align:right; margin:5px;"><span style="background:var(--accent); padding:5px 10px; border-radius:10px;">${input}</span></div>`;
            document.getElementById('botInput').value = ''; btn.disabled = true; btn.innerText = '...';
            try { const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(input)}`); const text = await response.text(); history.innerHTML += `<div style="text-align:left; margin:5px;"><span style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:10px;">${text}</span></div>`; } 
            catch (error) { history.innerHTML += `<div style="text-align:left; margin:5px;"><span style="color:var(--danger)">Ø­Ø¯Ø« Ø®Ø·Ø£.</span></div>`; }
            history.scrollTop = history.scrollHeight; btn.disabled = false; btn.innerText = 'Ø¥Ø±Ø³Ø§Ù„';
        }

        async function loadContest() {
            const cDiv = document.getElementById('contestEntries'); cDiv.innerHTML = '<div class="loader"></div>';
            const snapshot = await db.collection('contest_entries').orderBy('votes', 'desc').get(); cDiv.innerHTML = '';
            if (snapshot.empty) { cDiv.innerHTML = '<div style="padding:20px; text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>'; return; }
            snapshot.forEach(doc => {
                const entry = doc.data(); const hasVoted = entry.voters && entry.voters.includes(user);
                cDiv.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;"><div><div style="font-weight:bold;">${entry.title}</div><div style="font-size:12px; color:var(--text-muted);">Ø¨ÙˆØ§Ø³Ø·Ø©: ${entry.nominatedBy}</div></div><div style="text-align:center;"><div style="font-size:18px; font-weight:bold; color:var(--gold);">${entry.votes || 0} ğŸ—³ï¸</div>${hasVoted ? '<button disabled class="btn-xs btn-outline">ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª</button>' : `<button onclick="voteEntry('${doc.id}')" class="btn-xs btn-success">ØµÙˆØª</button>`}</div></div>`;
            });
        }

        function initSupportSystem() { if (ADMINS.includes(user)) return; currentChatUser = user; loadChatMessages(user); }
        function renderAdminUserList() {
            const listEl = document.getElementById('adminUserList');
            db.collection('users').orderBy('lastSupportMsg', 'desc').limit(20).onSnapshot(snapshot => {
                    listEl.innerHTML = ''; if(snapshot.empty) { listEl.innerHTML = '<div style="padding:15px; opacity:0.6;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ± Ù†Ø´Ø·Ø©.</div>'; return; }
                    snapshot.forEach(doc => {
                        const uData = doc.data(); const uName = doc.id; if(!uData.lastSupportMsg) return;
                        const item = document.createElement('div'); item.className = 'user-list-item'; if(currentChatUser === uName) item.classList.add('active');
                        item.innerHTML = `<div style="display:flex; align-items:center; gap:10px;"><img src="${uData.avatar}" style="width:30px; height:30px; border-radius:50%;"><div><div style="font-weight:bold; font-size:13px;">${uName}</div></div></div><div style="font-size:16px;">ğŸ’¬</div>`;
                        item.onclick = () => openAdminChat(uName); listEl.appendChild(item);
                    });
            });
        }
        function openAdminChat(targetUser) { currentChatUser = targetUser; document.getElementById('chatTitle').innerText = `Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹: ${targetUser}`; loadChatMessages(targetUser); }
        function loadChatMessages(targetUser) {
            const c = document.getElementById('dmMessages'); c.innerHTML = '<div class="loader" style="margin:20px auto; display:block;"></div>';
            if (chatListener) chatListener();
            chatListener = db.collection('support_chats').doc(targetUser).collection('messages').orderBy('createdAt', 'desc').limit(30).onSnapshot(snapshot => {
                    c.innerHTML = '';
                    if(snapshot.empty) { c.innerHTML = '<div style="text-align:center; margin-top:20px; opacity:0.5;">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©...</div>'; return; }
                    const msgs = []; snapshot.forEach(doc => msgs.push(doc.data()));
                    msgs.reverse().forEach(m => { const isMe = m.sender === user; c.innerHTML += `<div class="message ${isMe ? 'msg-me' : 'msg-other'}"><b>${m.sender}</b>: ${m.text}</div>`; });
                    c.scrollTop = c.scrollHeight;
            });
        }
        async function sendDM() {
            const input = document.getElementById('dmInput'); const text = input.value.trim(); if(!text || !currentChatUser) return;
            const batch = db.batch();
            const msgRef = db.collection('support_chats').doc(currentChatUser).collection('messages').doc();
            batch.set(msgRef, { text: text, sender: user, createdAt: new Date() });
            const userRef = db.collection('users').doc(currentChatUser);
            batch.update(userRef, { lastSupportMsg: new Date() });
            await batch.commit(); input.value = '';
        }
        
        async function translatePrompt() { const t=document.getElementById('transInput').value; if(!t)return; try{const r=await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(t)}&langpair=ar|en`); const d=await r.json(); document.getElementById('transOutput').value=d.responseData.translatedText;}catch(e){} }
        async function generateImage() { if(userData.points<5)return alert('5ğŸ’°'); const p=document.getElementById('genPrompt').value; if(!p)return; document.getElementById('genLoader').style.display='inline-block'; await db.collection('users').doc(user).update({points:firebase.firestore.FieldValue.increment(-5)}); document.getElementById('resultImage').onload=()=>{document.getElementById('genLoader').style.display='none'; document.getElementById('resultImage').style.display='block';}; document.getElementById('resultImage').src=`https://image.pollinations.ai/prompt/${encodeURIComponent(p)}?width=512&height=512&nologo=true`; }
        function requestPoints(amount) { alert(`Ù„Ø´Ø±Ø§Ø¡ ${amount} Ù†Ù‚Ø·Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø´Ø±Ù Ø¹Ø¨Ø± Ù‚Ø³Ù… Ø§Ù„Ø¯Ø¹Ù….`); switchTab('messages'); }
        async function createGiftCode() {
            const code = document.getElementById('adminCodeStr').value.trim(); const val = parseInt(document.getElementById('adminCodeVal').value);
            if(!code || !val) return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ù‚ÙŠÙ…Ø©');
            const check = await db.collection('redeem_codes').doc(code).get(); if(check.exists) return alert('Ù…ÙˆØ¬ÙˆØ¯!');
            await db.collection('redeem_codes').doc(code).set({ points: val, used: false, createdBy: user, createdAt: new Date() });
            notify(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ ${code}`);
        }
        async function redeemCode() {
            const codeInput = document.getElementById('redeemCodeInput').value.trim(); if(!codeInput) return;
            const codeRef = db.collection('redeem_codes').doc(codeInput); const userRef = db.collection('users').doc(user);
            try { await db.runTransaction(async (t) => {
                    const doc = await t.get(codeRef);
                    if (!doc.exists || doc.data().used) throw "ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦ Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù…";
                    t.update(codeRef, { used: true, usedBy: user, usedAt: new Date() });
                    t.update(userRef, { points: firebase.firestore.FieldValue.increment(doc.data().points) });
                }); notify(`ØªÙ… Ø§Ù„Ø´Ø­Ù†!`); } catch (e) { alert(e); }
        }

        function createSnow() {
            const container = document.getElementById('snowContainer');
            for (let i = 0; i < 20; i++) {
                const flake = document.createElement('div'); flake.classList.add('snowflake'); flake.innerText = 'â„';
                flake.style.left = Math.random() * 100 + 'vw'; flake.style.opacity = Math.random();
                flake.style.fontSize = Math.random() * 10 + 10 + 'px'; flake.style.animationDuration = Math.random() * 10 + 10 + 's';
                flake.style.animationDelay = Math.random() * 5 + 's'; container.appendChild(flake);
            }
        }
        createSnow(); loadUser(); loadFeed(); loadLeaderboard();
        document.querySelector('.nav-tab').click(); 
    </script>
</body>

</html>
